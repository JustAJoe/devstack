<!DOCTYPE html>
<html>
<head>
    <meta http-eqiv='content-type' content='text/html;charset=utf-8'>
    <title>keystone_data.sh</title>
    <link rel=stylesheet href="http://jashkenas.github.com/docco/resources/docco.css">
</head>
<body>
<div id=container>
    <div id=background></div>
    <table cellspacing=0 cellpadding=0>
    <thead>
      <tr>
        <th class=docs><h1>keystone_data.sh</h1></th>
        <th class=code></th>
      </tr>
    </thead>
    <tbody>
        <tr><td class='docs'></td><td class=code><div class=highlight><pre>
<span class="c">#!/bin/bash</span>

<span class="nv">ADMIN_PASSWORD</span><span class="o">=</span><span class="k">${</span><span class="nv">ADMIN_PASSWORD</span><span class="k">:-</span><span class="nv">secrete</span><span class="k">}</span>
<span class="nv">SERVICE_PASSWORD</span><span class="o">=</span><span class="k">${</span><span class="nv">SERVICE_PASSWORD</span><span class="k">:-</span><span class="nv">$ADMIN_PASSWORD</span><span class="k">}</span>
<span class="nb">export </span><span class="nv">SERVICE_TOKEN</span><span class="o">=</span><span class="nv">$SERVICE_TOKEN</span>
<span class="nb">export </span><span class="nv">SERVICE_ENDPOINT</span><span class="o">=</span><span class="nv">$SERVICE_ENDPOINT</span>
<span class="nv">SERVICE_TENANT_NAME</span><span class="o">=</span><span class="k">${</span><span class="nv">SERVICE_TENANT_NAME</span><span class="k">:-</span><span class="nv">service</span><span class="k">}</span>

<span class="k">function </span>get_id <span class="o">()</span> <span class="o">{</span>
    <span class="nb">echo</span> <span class="sb">`</span><span class="nv">$@</span> | awk <span class="s1">&#39;/ id / { print $4 }&#39;</span><span class="sb">`</span>
<span class="o">}</span>

</td><td class=code><div class=highlight><pre>
<span class="nv">ADMIN_TENANT</span><span class="o">=</span><span class="k">$(</span>get_id keystone tenant-create --name<span class="o">=</span>admin<span class="k">)</span>
<span class="nv">SERVICE_TENANT</span><span class="o">=</span><span class="k">$(</span>get_id keystone tenant-create --name<span class="o">=</span><span class="nv">$SERVICE_TENANT_NAME</span><span class="k">)</span>
<span class="nv">DEMO_TENANT</span><span class="o">=</span><span class="k">$(</span>get_id keystone tenant-create --name<span class="o">=</span>demo<span class="k">)</span>
<span class="nv">INVIS_TENANT</span><span class="o">=</span><span class="k">$(</span>get_id keystone tenant-create --name<span class="o">=</span>invisible_to_admin<span class="k">)</span>


</td><td class=code><div class=highlight><pre>
<span class="nv">ADMIN_USER</span><span class="o">=</span><span class="k">$(</span>get_id keystone user-create --name<span class="o">=</span>admin <span class="se">\</span>
                                         --pass<span class="o">=</span><span class="s2">&quot;$ADMIN_PASSWORD&quot;</span> <span class="se">\</span>
                                         --email<span class="o">=</span>admin@example.com<span class="k">)</span>
<span class="nv">DEMO_USER</span><span class="o">=</span><span class="k">$(</span>get_id keystone user-create --name<span class="o">=</span>demo <span class="se">\</span>
                                        --pass<span class="o">=</span><span class="s2">&quot;$ADMIN_PASSWORD&quot;</span> <span class="se">\</span>
                                        --email<span class="o">=</span>demo@example.com<span class="k">)</span>


</td><td class=code><div class=highlight><pre>
<span class="nv">ADMIN_ROLE</span><span class="o">=</span><span class="k">$(</span>get_id keystone role-create --name<span class="o">=</span>admin<span class="k">)</span>
<span class="nv">KEYSTONEADMIN_ROLE</span><span class="o">=</span><span class="k">$(</span>get_id keystone role-create --name<span class="o">=</span>KeystoneAdmin<span class="k">)</span>
<span class="nv">KEYSTONESERVICE_ROLE</span><span class="o">=</span><span class="k">$(</span>get_id keystone role-create --name<span class="o">=</span>KeystoneServiceAdmin<span class="k">)</span>
</td><td class=code><div class=highlight><pre>
<span class="nv">ANOTHER_ROLE</span><span class="o">=</span><span class="k">$(</span>get_id keystone role-create --name<span class="o">=</span>anotherrole<span class="k">)</span>


</td><td class=code><div class=highlight><pre>
keystone user-role-add --user <span class="nv">$ADMIN_USER</span> --role <span class="nv">$ADMIN_ROLE</span> --tenant_id <span class="nv">$ADMIN_TENANT</span>
keystone user-role-add --user <span class="nv">$ADMIN_USER</span> --role <span class="nv">$ADMIN_ROLE</span> --tenant_id <span class="nv">$DEMO_TENANT</span>
keystone user-role-add --user <span class="nv">$DEMO_USER</span> --role <span class="nv">$ANOTHER_ROLE</span> --tenant_id <span class="nv">$DEMO_TENANT</span>

</td><td class=code><div class=highlight><pre>
keystone user-role-add --user <span class="nv">$ADMIN_USER</span> --role <span class="nv">$KEYSTONEADMIN_ROLE</span> --tenant_id <span class="nv">$ADMIN_TENANT</span>
keystone user-role-add --user <span class="nv">$ADMIN_USER</span> --role <span class="nv">$KEYSTONESERVICE_ROLE</span> --tenant_id <span class="nv">$ADMIN_TENANT</span>


</td><td class=code><div class=highlight><pre>
<span class="nv">MEMBER_ROLE</span><span class="o">=</span><span class="k">$(</span>get_id keystone role-create --name<span class="o">=</span>Member<span class="k">)</span>
keystone user-role-add --user <span class="nv">$DEMO_USER</span> --role <span class="nv">$MEMBER_ROLE</span> --tenant_id <span class="nv">$DEMO_TENANT</span>
keystone user-role-add --user <span class="nv">$DEMO_USER</span> --role <span class="nv">$MEMBER_ROLE</span> --tenant_id <span class="nv">$INVIS_TENANT</span>


</td><td class=code><div class=highlight><pre>
<span class="nv">NOVA_USER</span><span class="o">=</span><span class="k">$(</span>get_id keystone user-create --name<span class="o">=</span>nova <span class="se">\</span>
                                        --pass<span class="o">=</span><span class="s2">&quot;$SERVICE_PASSWORD&quot;</span> <span class="se">\</span>
                                        --tenant_id <span class="nv">$SERVICE_TENANT</span> <span class="se">\</span>
                                        --email<span class="o">=</span>nova@example.com<span class="k">)</span>
keystone user-role-add --tenant_id <span class="nv">$SERVICE_TENANT</span> <span class="se">\</span>
                       --user <span class="nv">$NOVA_USER</span> <span class="se">\</span>
                       --role <span class="nv">$ADMIN_ROLE</span>

<span class="nv">GLANCE_USER</span><span class="o">=</span><span class="k">$(</span>get_id keystone user-create --name<span class="o">=</span>glance <span class="se">\</span>
                                          --pass<span class="o">=</span><span class="s2">&quot;$SERVICE_PASSWORD&quot;</span> <span class="se">\</span>
                                          --tenant_id <span class="nv">$SERVICE_TENANT</span> <span class="se">\</span>
                                          --email<span class="o">=</span>glance@example.com<span class="k">)</span>
keystone user-role-add --tenant_id <span class="nv">$SERVICE_TENANT</span> <span class="se">\</span>
                       --user <span class="nv">$GLANCE_USER</span> <span class="se">\</span>
                       --role <span class="nv">$ADMIN_ROLE</span>

<span class="k">if</span> <span class="o">[[</span> <span class="s2">&quot;$ENABLED_SERVICES&quot;</span> <span class="o">=</span>~ <span class="s2">&quot;swift&quot;</span> <span class="o">]]</span>; <span class="k">then</span>
<span class="k">    </span><span class="nv">SWIFT_USER</span><span class="o">=</span><span class="k">$(</span>get_id keystone user-create --name<span class="o">=</span>swift <span class="se">\</span>
                                             --pass<span class="o">=</span><span class="s2">&quot;$SERVICE_PASSWORD&quot;</span> <span class="se">\</span>
                                             --tenant_id <span class="nv">$SERVICE_TENANT</span> <span class="se">\</span>
                                             --email<span class="o">=</span>swift@example.com<span class="k">)</span>
    keystone user-role-add --tenant_id <span class="nv">$SERVICE_TENANT</span> <span class="se">\</span>
                           --user <span class="nv">$SWIFT_USER</span> <span class="se">\</span>
                           --role <span class="nv">$ADMIN_ROLE</span>
</td><td class=code><div class=highlight><pre>
    <span class="nv">RESELLER_ROLE</span><span class="o">=</span><span class="k">$(</span>get_id keystone role-create --name<span class="o">=</span>ResellerAdmin<span class="k">)</span>
    keystone user-role-add --tenant_id <span class="nv">$SERVICE_TENANT</span> <span class="se">\</span>
                           --user <span class="nv">$NOVA_USER</span> <span class="se">\</span>
                           --role <span class="nv">$RESELLER_ROLE</span>
<span class="k">fi</span>

<span class="k">if</span> <span class="o">[[</span> <span class="s2">&quot;$ENABLED_SERVICES&quot;</span> <span class="o">=</span>~ <span class="s2">&quot;quantum&quot;</span> <span class="o">]]</span>; <span class="k">then</span>
<span class="k">    </span><span class="nv">QUANTUM_USER</span><span class="o">=</span><span class="k">$(</span>get_id keystone user-create --name<span class="o">=</span>quantum <span class="se">\</span>
                                               --pass<span class="o">=</span><span class="s2">&quot;$SERVICE_PASSWORD&quot;</span> <span class="se">\</span>
                                               --tenant_id <span class="nv">$SERVICE_TENANT</span> <span class="se">\</span>
                                               --email<span class="o">=</span>quantum@example.com<span class="k">)</span>
    keystone user-role-add --tenant_id <span class="nv">$SERVICE_TENANT</span> <span class="se">\</span>
                           --user <span class="nv">$QUANTUM_USER</span> <span class="se">\</span>
                           --role <span class="nv">$ADMIN_ROLE</span>
<span class="k">fi</span>


</td><td class=code><div class=highlight><pre></td><td class='code'></td></tr>
    </tbody>
    </table>
</div>
</body>
</html>
