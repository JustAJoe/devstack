<!DOCTYPE html>
<html>
<head>
    <meta http-eqiv='content-type' content='text/html;charset=utf-8'>
    <title>nova</title>
    <link rel=stylesheet href="http://jashkenas.github.com/docco/resources/docco.css">
</head>
<body>
<div id=container>
    <div id=background></div>
    <table cellspacing=0 cellpadding=0>
    <thead>
      <tr>
        <th class=docs><h1>nova</h1></th>
        <th class=code></th>
      </tr>
    </thead>
    <tbody>
        <tr><td class='docs'><?xml version="1.0" encoding="utf-8" ?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="generator" content="Docutils 0.7: http://docutils.sourceforge.net/" />
<title></title>
<style type="text/css">

/*
:Author: David Goodger (goodger@python.org)
:Id: $Id: html4css1.css 6253 2010-03-02 00:24:53Z milde $
:Copyright: This stylesheet has been placed in the public domain.

Default cascading style sheet for the HTML output of Docutils.

See http://docutils.sf.net/docs/howto/html-stylesheets.html for how to
customize this style sheet.
*/

/* used to remove borders from tables and images */
.borderless, table.borderless td, table.borderless th {
  border: 0 }

table.borderless td, table.borderless th {
  /* Override padding for "table.docutils td" with "! important".
     The right padding separates the table cells. */
  padding: 0 0.5em 0 0 ! important }

.first {
  /* Override more specific margin styles with "! important". */
  margin-top: 0 ! important }

.last, .with-subtitle {
  margin-bottom: 0 ! important }

.hidden {
  display: none }

a.toc-backref {
  text-decoration: none ;
  color: black }

blockquote.epigraph {
  margin: 2em 5em ; }

dl.docutils dd {
  margin-bottom: 0.5em }

/* Uncomment (and remove this text!) to get bold-faced definition list terms
dl.docutils dt {
  font-weight: bold }
*/

div.abstract {
  margin: 2em 5em }

div.abstract p.topic-title {
  font-weight: bold ;
  text-align: center }

div.admonition, div.attention, div.caution, div.danger, div.error,
div.hint, div.important, div.note, div.tip, div.warning {
  margin: 2em ;
  border: medium outset ;
  padding: 1em }

div.admonition p.admonition-title, div.hint p.admonition-title,
div.important p.admonition-title, div.note p.admonition-title,
div.tip p.admonition-title {
  font-weight: bold ;
  font-family: sans-serif }

div.attention p.admonition-title, div.caution p.admonition-title,
div.danger p.admonition-title, div.error p.admonition-title,
div.warning p.admonition-title {
  color: red ;
  font-weight: bold ;
  font-family: sans-serif }

/* Uncomment (and remove this text!) to get reduced vertical space in
   compound paragraphs.
div.compound .compound-first, div.compound .compound-middle {
  margin-bottom: 0.5em }

div.compound .compound-last, div.compound .compound-middle {
  margin-top: 0.5em }
*/

div.dedication {
  margin: 2em 5em ;
  text-align: center ;
  font-style: italic }

div.dedication p.topic-title {
  font-weight: bold ;
  font-style: normal }

div.figure {
  margin-left: 2em ;
  margin-right: 2em }

div.footer, div.header {
  clear: both;
  font-size: smaller }

div.line-block {
  display: block ;
  margin-top: 1em ;
  margin-bottom: 1em }

div.line-block div.line-block {
  margin-top: 0 ;
  margin-bottom: 0 ;
  margin-left: 1.5em }

div.sidebar {
  margin: 0 0 0.5em 1em ;
  border: medium outset ;
  padding: 1em ;
  background-color: #ffffee ;
  width: 40% ;
  float: right ;
  clear: right }

div.sidebar p.rubric {
  font-family: sans-serif ;
  font-size: medium }

div.system-messages {
  margin: 5em }

div.system-messages h1 {
  color: red }

div.system-message {
  border: medium outset ;
  padding: 1em }

div.system-message p.system-message-title {
  color: red ;
  font-weight: bold }

div.topic {
  margin: 2em }

h1.section-subtitle, h2.section-subtitle, h3.section-subtitle,
h4.section-subtitle, h5.section-subtitle, h6.section-subtitle {
  margin-top: 0.4em }

h1.title {
  text-align: center }

h2.subtitle {
  text-align: center }

hr.docutils {
  width: 75% }

img.align-left, .figure.align-left, object.align-left {
  clear: left ;
  float: left ;
  margin-right: 1em }

img.align-right, .figure.align-right, object.align-right {
  clear: right ;
  float: right ;
  margin-left: 1em }

img.align-center, .figure.align-center, object.align-center {
  display: block;
  margin-left: auto;
  margin-right: auto;
}

.align-left {
  text-align: left }

.align-center {
  clear: both ;
  text-align: center }

.align-right {
  text-align: right }

/* reset inner alignment in figures */
div.align-right {
  text-align: left }

/* div.align-center * { */
/*   text-align: left } */

ol.simple, ul.simple {
  margin-bottom: 1em }

ol.arabic {
  list-style: decimal }

ol.loweralpha {
  list-style: lower-alpha }

ol.upperalpha {
  list-style: upper-alpha }

ol.lowerroman {
  list-style: lower-roman }

ol.upperroman {
  list-style: upper-roman }

p.attribution {
  text-align: right ;
  margin-left: 50% }

p.caption {
  font-style: italic }

p.credits {
  font-style: italic ;
  font-size: smaller }

p.label {
  white-space: nowrap }

p.rubric {
  font-weight: bold ;
  font-size: larger ;
  color: maroon ;
  text-align: center }

p.sidebar-title {
  font-family: sans-serif ;
  font-weight: bold ;
  font-size: larger }

p.sidebar-subtitle {
  font-family: sans-serif ;
  font-weight: bold }

p.topic-title {
  font-weight: bold }

pre.address {
  margin-bottom: 0 ;
  margin-top: 0 ;
  font: inherit }

pre.literal-block, pre.doctest-block {
  margin-left: 2em ;
  margin-right: 2em }

span.classifier {
  font-family: sans-serif ;
  font-style: oblique }

span.classifier-delimiter {
  font-family: sans-serif ;
  font-weight: bold }

span.interpreted {
  font-family: sans-serif }

span.option {
  white-space: nowrap }

span.pre {
  white-space: pre }

span.problematic {
  color: red }

span.section-subtitle {
  /* font-size relative to parent (h1..h6 element) */
  font-size: 80% }

table.citation {
  border-left: solid 1px gray;
  margin-left: 1px }

table.docinfo {
  margin: 2em 4em }

table.docutils {
  margin-top: 0.5em ;
  margin-bottom: 0.5em }

table.footnote {
  border-left: solid 1px black;
  margin-left: 1px }

table.docutils td, table.docutils th,
table.docinfo td, table.docinfo th {
  padding-left: 0.5em ;
  padding-right: 0.5em ;
  vertical-align: top }

table.docutils th.field-name, table.docinfo th.docinfo-name {
  font-weight: bold ;
  text-align: left ;
  white-space: nowrap ;
  padding-left: 0 }

h1 tt.docutils, h2 tt.docutils, h3 tt.docutils,
h4 tt.docutils, h5 tt.docutils, h6 tt.docutils {
  font-size: 100% }

ul.auto-toc {
  list-style-type: none }

</style>
</head>
<body>
<div class="document">


<p>lib/nova
Functions to control the configuration and operation of the XXXX service
Dependencies:
<tt class="docutils literal">functions</tt> file
<tt class="docutils literal">DEST</tt>, <tt class="docutils literal">DATA_DIR</tt> must be defined
<tt class="docutils literal">SERVICE_{TENANT_NAME|PASSWORD}</tt> must be defined
<tt class="docutils literal">LIBVIRT_TYPE</tt> must be defined
<tt class="docutils literal">INSTANCE_NAME_PREFIX</tt>, <tt class="docutils literal">VOLUME_NAME_PREFIX</tt> must be defined</p>
</td><td class=code><div class=highlight><pre>


</pre></div></td></tr><tr><td class=docs>
<p><tt class="docutils literal">stack.sh</tt> calls the entry points in this order:</p>
<p>install_nova
configure_nova
init_nova
start_nova
stop_nova
cleanup_nova</p>
</td><td class=code><div class=highlight><pre>

</pre></div></td></tr><tr><td class=docs>
<p>Save trace setting</p>
</td><td class=code><div class=highlight><pre>
<span class="nv">XTRACE</span><span class="o">=</span><span class="k">$(</span><span class="nb">set</span> +o | grep xtrace<span class="k">)</span>
<span class="nb">set</span> +o xtrace


</pre></div></td></tr><tr><td class=docs>
<div class="section" id="defaults">
<h1>Defaults</h1>
</td><td class=code><div class=highlight><pre>

</pre></div></td></tr><tr><td class=docs>
<p>Set up default directories</p>
</td><td class=code><div class=highlight><pre>
<span class="nv">NOVA_DIR</span><span class="o">=</span><span class="nv">$DEST</span>/nova
<span class="nv">NOVACLIENT_DIR</span><span class="o">=</span><span class="nv">$DEST</span>/python-novaclient
<span class="nv">NOVA_STATE_PATH</span><span class="o">=</span><span class="k">${</span><span class="nv">NOVA_STATE_PATH</span><span class="p">:=</span><span class="nv">$DATA_DIR</span><span class="p">/nova</span><span class="k">}</span>
</pre></div></td></tr><tr><td class=docs>
<p>INSTANCES_PATH is the previous name for this</p>
</td><td class=code><div class=highlight><pre>
<span class="nv">NOVA_INSTANCES_PATH</span><span class="o">=</span><span class="k">${</span><span class="nv">NOVA_INSTANCES_PATH</span><span class="p">:=</span><span class="k">${</span><span class="nv">INSTANCES_PATH</span><span class="p">:=</span><span class="nv">$NOVA_STATE_PATH</span><span class="p">/instances</span><span class="k">}}</span>

<span class="nv">NOVA_CONF_DIR</span><span class="o">=</span>/etc/nova
<span class="nv">NOVA_CONF</span><span class="o">=</span><span class="nv">$NOVA_CONF_DIR</span>/nova.conf
<span class="nv">NOVA_API_PASTE_INI</span><span class="o">=</span><span class="k">${</span><span class="nv">NOVA_API_PASTE_INI</span><span class="k">:-</span><span class="nv">$NOVA_CONF_DIR</span><span class="p">/api-paste.ini</span><span class="k">}</span>

</pre></div></td></tr><tr><td class=docs>
<p>Support entry points installation of console scripts</p>
</td><td class=code><div class=highlight><pre>
<span class="k">if</span> <span class="o">[[</span> -d <span class="nv">$NOVA_DIR</span>/bin <span class="o">]]</span>; <span class="k">then</span>
<span class="k">    </span><span class="nv">NOVA_BIN_DIR</span><span class="o">=</span><span class="nv">$NOVA_DIR</span>/bin
<span class="k">else</span>
<span class="k">    </span><span class="nv">NOVA_BIN_DIR</span><span class="o">=</span>/usr/local/bin
<span class="k">fi</span>

</pre></div></td></tr><tr><td class=docs>
<p>Set the paths of certain binaries</p>
</td><td class=code><div class=highlight><pre>
<span class="k">if</span> <span class="o">[[</span> <span class="s2">&quot;$os_PACKAGE&quot;</span> <span class="o">=</span> <span class="s2">&quot;deb&quot;</span> <span class="o">]]</span>; <span class="k">then</span>
<span class="k">    </span><span class="nv">NOVA_ROOTWRAP</span><span class="o">=</span>/usr/local/bin/nova-rootwrap
<span class="k">else</span>
<span class="k">    </span><span class="nv">NOVA_ROOTWRAP</span><span class="o">=</span>/usr/bin/nova-rootwrap
<span class="k">fi</span>

</pre></div></td></tr><tr><td class=docs>
<p>Allow rate limiting to be turned off for testing, like for Tempest
NOTE: Set API_RATE_LIMIT=&quot;False&quot; to turn OFF rate limiting</p>
</td><td class=code><div class=highlight><pre>
<span class="nv">API_RATE_LIMIT</span><span class="o">=</span><span class="k">${</span><span class="nv">API_RATE_LIMIT</span><span class="k">:-</span><span class="s2">&quot;True&quot;</span><span class="k">}</span>

</pre></div></td></tr><tr><td class=docs>
<p>Nova supports pluggable schedulers.  The default <tt class="docutils literal">FilterScheduler</tt>
should work in most cases.</p>
</td><td class=code><div class=highlight><pre>
<span class="nv">SCHEDULER</span><span class="o">=</span><span class="k">${</span><span class="nv">SCHEDULER</span><span class="k">:-</span><span class="nv">nova</span><span class="p">.scheduler.filter_scheduler.FilterScheduler</span><span class="k">}</span>

<span class="nv">QEMU_CONF</span><span class="o">=</span>/etc/libvirt/qemu.conf


</pre></div></td></tr><tr><td class=docs>
</div>
<div class="section" id="entry-points">
<h1>Entry Points</h1>
</td><td class=code><div class=highlight><pre>

<span class="k">function </span>add_nova_opt <span class="o">{</span>
    <span class="nb">echo</span> <span class="s2">&quot;$1&quot;</span> &gt;&gt;<span class="nv">$NOVA_CONF</span>
<span class="o">}</span>

</pre></div></td></tr><tr><td class=docs>
<p>Helper to clean iptables rules</p>
</td><td class=code><div class=highlight><pre>
<span class="k">function </span>clean_iptables<span class="o">()</span> <span class="o">{</span>
</pre></div></td></tr><tr><td class=docs>
<p>Delete rules</p>
</td><td class=code><div class=highlight><pre>
    sudo iptables -S -v | sed <span class="s2">&quot;s/-c [0-9]* [0-9]* //g&quot;</span> | grep <span class="s2">&quot;nova&quot;</span> | grep <span class="s2">&quot;\-A&quot;</span> |  sed <span class="s2">&quot;s/-A/-D/g&quot;</span> | awk <span class="s1">&#39;{print &quot;sudo iptables&quot;,$0}&#39;</span> | bash
</pre></div></td></tr><tr><td class=docs>
<p>Delete nat rules</p>
</td><td class=code><div class=highlight><pre>
    sudo iptables -S -v -t nat | sed <span class="s2">&quot;s/-c [0-9]* [0-9]* //g&quot;</span> | grep <span class="s2">&quot;nova&quot;</span> |  grep <span class="s2">&quot;\-A&quot;</span> | sed <span class="s2">&quot;s/-A/-D/g&quot;</span> | awk <span class="s1">&#39;{print &quot;sudo iptables -t nat&quot;,$0}&#39;</span> | bash
</pre></div></td></tr><tr><td class=docs>
<p>Delete chains</p>
</td><td class=code><div class=highlight><pre>
    sudo iptables -S -v | sed <span class="s2">&quot;s/-c [0-9]* [0-9]* //g&quot;</span> | grep <span class="s2">&quot;nova&quot;</span> | grep <span class="s2">&quot;\-N&quot;</span> |  sed <span class="s2">&quot;s/-N/-X/g&quot;</span> | awk <span class="s1">&#39;{print &quot;sudo iptables&quot;,$0}&#39;</span> | bash
</pre></div></td></tr><tr><td class=docs>
<p>Delete nat chains</p>
</td><td class=code><div class=highlight><pre>
    sudo iptables -S -v -t nat | sed <span class="s2">&quot;s/-c [0-9]* [0-9]* //g&quot;</span> | grep <span class="s2">&quot;nova&quot;</span> |  grep <span class="s2">&quot;\-N&quot;</span> | sed <span class="s2">&quot;s/-N/-X/g&quot;</span> | awk <span class="s1">&#39;{print &quot;sudo iptables -t nat&quot;,$0}&#39;</span> | bash
<span class="o">}</span>

</pre></div></td></tr><tr><td class=docs>
<p>cleanup_nova() - Remove residual data files, anything left over from previous
runs that a clean run would need to clean up</p>
</td><td class=code><div class=highlight><pre>
<span class="k">function </span>cleanup_nova<span class="o">()</span> <span class="o">{</span>
    <span class="k">if </span>is_service_enabled n-cpu; <span class="k">then</span>
</pre></div></td></tr><tr><td class=docs>
<p>Clean iptables from previous runs</p>
</td><td class=code><div class=highlight><pre>
        clean_iptables

</pre></div></td></tr><tr><td class=docs>
<p>Destroy old instances</p>
</td><td class=code><div class=highlight><pre>
        <span class="nv">instances</span><span class="o">=</span><span class="sb">`</span>sudo virsh list --all | grep <span class="nv">$INSTANCE_NAME_PREFIX</span> | sed <span class="s2">&quot;s/.*\($INSTANCE_NAME_PREFIX[0-9a-fA-F]*\).*/\1/g&quot;</span><span class="sb">`</span>
        <span class="k">if</span> <span class="o">[</span> ! <span class="s2">&quot;$instances&quot;</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span> <span class="o">]</span>; <span class="k">then</span>
<span class="k">            </span><span class="nb">echo</span> <span class="nv">$instances</span> | xargs -n1 sudo virsh destroy <span class="o">||</span> <span class="nb">true</span>
<span class="nb">            echo</span> <span class="nv">$instances</span> | xargs -n1 sudo virsh undefine <span class="o">||</span> <span class="nb">true</span>
<span class="nb">        </span><span class="k">fi</span>

</pre></div></td></tr><tr><td class=docs>
<p>Logout and delete iscsi sessions</p>
</td><td class=code><div class=highlight><pre>
        sudo iscsiadm --mode node | grep <span class="nv">$VOLUME_NAME_PREFIX</span> | cut -d <span class="s2">&quot; &quot;</span> -f2 | xargs sudo iscsiadm --mode node --logout <span class="o">||</span> <span class="nb">true</span>
<span class="nb">        </span>sudo iscsiadm --mode node | grep <span class="nv">$VOLUME_NAME_PREFIX</span> | cut -d <span class="s2">&quot; &quot;</span> -f2 | sudo iscsiadm --mode node --op delete <span class="o">||</span> <span class="nb">true</span>

</pre></div></td></tr><tr><td class=docs>
<p>Clean out the instances directory.</p>
</td><td class=code><div class=highlight><pre>
        sudo rm -rf <span class="nv">$NOVA_INSTANCES_PATH</span>/*
    <span class="k">fi</span>
<span class="o">}</span>

</pre></div></td></tr><tr><td class=docs>
<p>configure_novaclient() - Set config files, create data dirs, etc</p>
</td><td class=code><div class=highlight><pre>
<span class="k">function </span>configure_novaclient<span class="o">()</span> <span class="o">{</span>
    setup_develop <span class="nv">$NOVACLIENT_DIR</span>
<span class="o">}</span>

</pre></div></td></tr><tr><td class=docs>
<p>configure_nova_rootwrap() - configure Nova's rootwrap</p>
</td><td class=code><div class=highlight><pre>
<span class="k">function </span>configure_nova_rootwrap<span class="o">()</span> <span class="o">{</span>
</pre></div></td></tr><tr><td class=docs>
<p>Deploy new rootwrap filters files (owned by root).
Wipe any existing rootwrap.d files first</p>
</td><td class=code><div class=highlight><pre>
    <span class="k">if</span> <span class="o">[[</span> -d <span class="nv">$NOVA_CONF_DIR</span>/rootwrap.d <span class="o">]]</span>; <span class="k">then</span>
<span class="k">        </span>sudo rm -rf <span class="nv">$NOVA_CONF_DIR</span>/rootwrap.d
    <span class="k">fi</span>
</pre></div></td></tr><tr><td class=docs>
<p>Deploy filters to /etc/nova/rootwrap.d</p>
</td><td class=code><div class=highlight><pre>
    sudo mkdir -m 755 <span class="nv">$NOVA_CONF_DIR</span>/rootwrap.d
    sudo cp <span class="nv">$NOVA_DIR</span>/etc/nova/rootwrap.d/*.filters <span class="nv">$NOVA_CONF_DIR</span>/rootwrap.d
    sudo chown -R root:root <span class="nv">$NOVA_CONF_DIR</span>/rootwrap.d
    sudo chmod 644 <span class="nv">$NOVA_CONF_DIR</span>/rootwrap.d/*
</pre></div></td></tr><tr><td class=docs>
<p>Set up rootwrap.conf, pointing to /etc/nova/rootwrap.d</p>
</td><td class=code><div class=highlight><pre>
    sudo cp <span class="nv">$NOVA_DIR</span>/etc/nova/rootwrap.conf <span class="nv">$NOVA_CONF_DIR</span>/
    sudo sed -e <span class="s2">&quot;s:^filters_path=.*$:filters_path=$NOVA_CONF_DIR/rootwrap.d:&quot;</span> -i <span class="nv">$NOVA_CONF_DIR</span>/rootwrap.conf
    sudo chown root:root <span class="nv">$NOVA_CONF_DIR</span>/rootwrap.conf
    sudo chmod 0644 <span class="nv">$NOVA_CONF_DIR</span>/rootwrap.conf
</pre></div></td></tr><tr><td class=docs>
<p>Specify rootwrap.conf as first parameter to nova-rootwrap</p>
</td><td class=code><div class=highlight><pre>
    <span class="nv">ROOTWRAP_SUDOER_CMD</span><span class="o">=</span><span class="s2">&quot;$NOVA_ROOTWRAP $NOVA_CONF_DIR/rootwrap.conf *&quot;</span>

</pre></div></td></tr><tr><td class=docs>
<p>Set up the rootwrap sudoers for nova</p>
</td><td class=code><div class=highlight><pre>
    <span class="nv">TEMPFILE</span><span class="o">=</span><span class="sb">`</span>mktemp<span class="sb">`</span>
    <span class="nb">echo</span> <span class="s2">&quot;$USER ALL=(root) NOPASSWD: $ROOTWRAP_SUDOER_CMD&quot;</span> &gt;<span class="nv">$TEMPFILE</span>
    chmod 0440 <span class="nv">$TEMPFILE</span>
    sudo chown root:root <span class="nv">$TEMPFILE</span>
    sudo mv <span class="nv">$TEMPFILE</span> /etc/sudoers.d/nova-rootwrap
<span class="o">}</span>

</pre></div></td></tr><tr><td class=docs>
<p>configure_nova() - Set config files, create data dirs, etc</p>
</td><td class=code><div class=highlight><pre>
<span class="k">function </span>configure_nova<span class="o">()</span> <span class="o">{</span>
    setup_develop <span class="nv">$NOVA_DIR</span>

</pre></div></td></tr><tr><td class=docs>
<p>Put config files in <tt class="docutils literal">/etc/nova</tt> for everyone to find</p>
</td><td class=code><div class=highlight><pre>
    <span class="k">if</span> <span class="o">[[</span> ! -d <span class="nv">$NOVA_CONF_DIR</span> <span class="o">]]</span>; <span class="k">then</span>
<span class="k">        </span>sudo mkdir -p <span class="nv">$NOVA_CONF_DIR</span>
    <span class="k">fi</span>
<span class="k">    </span>sudo chown <span class="sb">`</span>whoami<span class="sb">`</span> <span class="nv">$NOVA_CONF_DIR</span>

    cp -p <span class="nv">$NOVA_DIR</span>/etc/nova/policy.json <span class="nv">$NOVA_CONF_DIR</span>

    configure_nova_rootwrap

    <span class="k">if </span>is_service_enabled n-api; <span class="k">then</span>
</pre></div></td></tr><tr><td class=docs>
<p>Use the sample http middleware configuration supplied in the
Nova sources.  This paste config adds the configuration required
for Nova to validate Keystone tokens.</p>
</td><td class=code><div class=highlight><pre>

</pre></div></td></tr><tr><td class=docs>
<p>Remove legacy paste config if present</p>
</td><td class=code><div class=highlight><pre>
        rm -f <span class="nv">$NOVA_DIR</span>/bin/nova-api-paste.ini

</pre></div></td></tr><tr><td class=docs>
<p>Get the sample configuration file in place</p>
</td><td class=code><div class=highlight><pre>
        cp <span class="nv">$NOVA_DIR</span>/etc/nova/api-paste.ini <span class="nv">$NOVA_CONF_DIR</span>

</pre></div></td></tr><tr><td class=docs>
<p>Rewrite the authtoken configuration for our Keystone service.
This is a bit defensive to allow the sample file some variance.</p>
</td><td class=code><div class=highlight><pre>
        sed -e <span class="s2">&quot;</span>
<span class="s2">            /^admin_token/i admin_tenant_name = $SERVICE_TENANT_NAME</span>
<span class="s2">            /admin_tenant_name/s/^.*$/admin_tenant_name = $SERVICE_TENANT_NAME/;</span>
<span class="s2">            /admin_user/s/^.*$/admin_user = nova/;</span>
<span class="s2">            /admin_password/s/^.*$/admin_password = $SERVICE_PASSWORD/;</span>
<span class="s2">            s,%SERVICE_TENANT_NAME%,$SERVICE_TENANT_NAME,g;</span>
<span class="s2">            s,%SERVICE_TOKEN%,$SERVICE_TOKEN,g;</span>
<span class="s2">        &quot;</span> -i <span class="nv">$NOVA_API_PASTE_INI</span>
    <span class="k">fi</span>

<span class="k">    if </span>is_service_enabled n-cpu; <span class="k">then</span>
</pre></div></td></tr><tr><td class=docs>
<p>Force IP forwarding on, just on case</p>
</td><td class=code><div class=highlight><pre>
        sudo sysctl -w net.ipv4.ip_forward<span class="o">=</span>1

</pre></div></td></tr><tr><td class=docs>
<p>Attempt to load modules: network block device - used to manage qcow images</p>
</td><td class=code><div class=highlight><pre>
        sudo modprobe nbd <span class="o">||</span> <span class="nb">true</span>

</pre></div></td></tr><tr><td class=docs>
<p>Check for kvm (hardware based virtualization).  If unable to initialize
kvm, we drop back to the slower emulation mode (qemu).  Note: many systems
come with hardware virtualization disabled in BIOS.</p>
</td><td class=code><div class=highlight><pre>
        <span class="k">if</span> <span class="o">[[</span> <span class="s2">&quot;$LIBVIRT_TYPE&quot;</span> <span class="o">==</span> <span class="s2">&quot;kvm&quot;</span> <span class="o">]]</span>; <span class="k">then</span>
<span class="k">            </span>sudo modprobe kvm <span class="o">||</span> <span class="nb">true</span>
<span class="nb">            </span><span class="k">if</span> <span class="o">[</span> ! -e /dev/kvm <span class="o">]</span>; <span class="k">then</span>
<span class="k">                </span><span class="nb">echo</span> <span class="s2">&quot;WARNING: Switching to QEMU&quot;</span>
                <span class="nv">LIBVIRT_TYPE</span><span class="o">=</span>qemu
                <span class="k">if </span>which selinuxenabled 2&gt;&amp;1 &gt; /dev/null <span class="o">&amp;&amp;</span> selinuxenabled; <span class="k">then</span>
</pre></div></td></tr><tr><td class=docs>
<p><a class="reference external" href="https://bugzilla.redhat.com/show_bug.cgi?id=753589">https://bugzilla.redhat.com/show_bug.cgi?id=753589</a></p>
</td><td class=code><div class=highlight><pre>
                    sudo setsebool virt_use_execmem on
                <span class="k">fi</span>
<span class="k">            fi</span>
<span class="k">        fi</span>

</pre></div></td></tr><tr><td class=docs>
<p>Install and configure <strong>LXC</strong> if specified.  LXC is another approach to
splitting a system into many smaller parts.  LXC uses cgroups and chroot
to simulate multiple systems.</p>
</td><td class=code><div class=highlight><pre>
        <span class="k">if</span> <span class="o">[[</span> <span class="s2">&quot;$LIBVIRT_TYPE&quot;</span> <span class="o">==</span> <span class="s2">&quot;lxc&quot;</span> <span class="o">]]</span>; <span class="k">then</span>
<span class="k">            if</span> <span class="o">[[</span> <span class="s2">&quot;$os_PACKAGE&quot;</span> <span class="o">=</span> <span class="s2">&quot;deb&quot;</span> <span class="o">]]</span>; <span class="k">then</span>
<span class="k">                if</span> <span class="o">[[</span> ! <span class="s2">&quot;$DISTRO&quot;</span> &gt; natty <span class="o">]]</span>; <span class="k">then</span>
<span class="k">                    </span><span class="nv">cgline</span><span class="o">=</span><span class="s2">&quot;none /cgroup cgroup cpuacct,memory,devices,cpu,freezer,blkio 0 0&quot;</span>
                    sudo mkdir -p /cgroup
                    <span class="k">if</span> ! grep -q cgroup /etc/fstab; <span class="k">then</span>
<span class="k">                        </span><span class="nb">echo</span> <span class="s2">&quot;$cgline&quot;</span> | sudo tee -a /etc/fstab
                    <span class="k">fi</span>
<span class="k">                    if</span> ! mount -n | grep -q cgroup; <span class="k">then</span>
<span class="k">                        </span>sudo mount /cgroup
                    <span class="k">fi</span>
<span class="k">                fi</span>
<span class="k">            fi</span>
<span class="k">        fi</span>

<span class="k">        if </span>is_service_enabled quantum <span class="o">&amp;&amp;</span> is_quantum_ovs_base_plugin <span class="s2">&quot;$Q_PLUGIN&quot;</span> <span class="o">&amp;&amp;</span> ! sudo grep -q <span class="s1">&#39;^cgroup_device_acl&#39;</span> <span class="nv">$QEMU_CONF</span> ; <span class="k">then</span>
</pre></div></td></tr><tr><td class=docs>
<p>Add /dev/net/tun to cgroup_device_acls, needed for type=ethernet interfaces</p>
</td><td class=code><div class=highlight><pre>
            cat <span class="s">&lt;&lt;EOF | sudo tee -a $QEMU_CONF</span>
<span class="s">cgroup_device_acl = [</span>
<span class="s">    &quot;/dev/null&quot;, &quot;/dev/full&quot;, &quot;/dev/zero&quot;,</span>
<span class="s">    &quot;/dev/random&quot;, &quot;/dev/urandom&quot;,</span>
<span class="s">    &quot;/dev/ptmx&quot;, &quot;/dev/kvm&quot;, &quot;/dev/kqemu&quot;,</span>
<span class="s">    &quot;/dev/rtc&quot;, &quot;/dev/hpet&quot;,&quot;/dev/net/tun&quot;,</span>
<span class="s">]</span>
<span class="s">EOF</span>
        <span class="k">fi</span>

<span class="k">        if</span> <span class="o">[[</span> <span class="s2">&quot;$os_PACKAGE&quot;</span> <span class="o">=</span> <span class="s2">&quot;deb&quot;</span> <span class="o">]]</span>; <span class="k">then</span>
<span class="k">            </span><span class="nv">LIBVIRT_DAEMON</span><span class="o">=</span>libvirt-bin
        <span class="k">else</span>
</pre></div></td></tr><tr><td class=docs>
<p><a class="reference external" href="http://wiki.libvirt.org/page/SSHPolicyKitSetup">http://wiki.libvirt.org/page/SSHPolicyKitSetup</a></p>
</td><td class=code><div class=highlight><pre>
            <span class="k">if</span> ! grep ^libvirtd: /etc/group &gt;/dev/null; <span class="k">then</span>
<span class="k">                </span>sudo groupadd libvirtd
            <span class="k">fi</span>
<span class="k">            </span>sudo bash -c <span class="s1">&#39;cat &lt;&lt;EOF &gt;/etc/polkit-1/localauthority/50-local.d/50-libvirt-remote-access.pkla</span>
<span class="s1">[libvirt Management Access]</span>
<span class="s1">Identity=unix-group:libvirtd</span>
<span class="s1">Action=org.libvirt.unix.manage</span>
<span class="s1">ResultAny=yes</span>
<span class="s1">ResultInactive=yes</span>
<span class="s1">ResultActive=yes</span>
<span class="s1">EOF&#39;</span>
            <span class="nv">LIBVIRT_DAEMON</span><span class="o">=</span>libvirtd
        <span class="k">fi</span>

</pre></div></td></tr><tr><td class=docs>
<p>The user that nova runs as needs to be member of <strong>libvirtd</strong> group otherwise
nova-compute will be unable to use libvirt.</p>
</td><td class=code><div class=highlight><pre>
        sudo usermod -a -G libvirtd <span class="sb">`</span>whoami<span class="sb">`</span>

</pre></div></td></tr><tr><td class=docs>
<p>libvirt detects various settings on startup, as we potentially changed
the system configuration (modules, filesystems), we need to restart
libvirt to detect those changes.</p>
</td><td class=code><div class=highlight><pre>
        restart_service <span class="nv">$LIBVIRT_DAEMON</span>


</pre></div></td></tr><tr><td class=docs>
</div>
<div class="section" id="instance-storage">
<h1>Instance Storage</h1>
</td><td class=code><div class=highlight><pre>

</pre></div></td></tr><tr><td class=docs>
<p>Nova stores each instance in its own directory.</p>
</td><td class=code><div class=highlight><pre>
        mkdir -p <span class="nv">$NOVA_INSTANCES_PATH</span>

</pre></div></td></tr><tr><td class=docs>
<p>You can specify a different disk to be mounted and used for backing the
virtual machines.  If there is a partition labeled nova-instances we
mount it (ext filesystems can be labeled via e2label).</p>
</td><td class=code><div class=highlight><pre>
        <span class="k">if</span> <span class="o">[</span> -L /dev/disk/by-label/nova-instances <span class="o">]</span>; <span class="k">then</span>
<span class="k">            if</span> ! mount -n | grep -q <span class="nv">$NOVA_INSTANCES_PATH</span>; <span class="k">then</span>
<span class="k">                </span>sudo mount -L nova-instances <span class="nv">$NOVA_INSTANCES_PATH</span>
                sudo chown -R <span class="sb">`</span>whoami<span class="sb">`</span> <span class="nv">$NOVA_INSTANCES_PATH</span>
            <span class="k">fi</span>
<span class="k">        fi</span>

</pre></div></td></tr><tr><td class=docs>
<p>Clean up old instances</p>
</td><td class=code><div class=highlight><pre>
        cleanup_nova
    <span class="k">fi</span>
<span class="o">}</span>

</pre></div></td></tr><tr><td class=docs>
<p>init_nova() - Initialize databases, etc.</p>
</td><td class=code><div class=highlight><pre>
<span class="k">function </span>init_nova<span class="o">()</span> <span class="o">{</span>
</pre></div></td></tr><tr><td class=docs>
<p>Remove legacy <tt class="docutils literal">nova.conf</tt></p>
</td><td class=code><div class=highlight><pre>
    rm -f <span class="nv">$NOVA_DIR</span>/bin/nova.conf

</pre></div></td></tr><tr><td class=docs>
<p>(Re)create <tt class="docutils literal">nova.conf</tt></p>
</td><td class=code><div class=highlight><pre>
    rm -f <span class="nv">$NOVA_CONF</span>
    add_nova_opt <span class="s2">&quot;[DEFAULT]&quot;</span>
    add_nova_opt <span class="s2">&quot;verbose=True&quot;</span>
    add_nova_opt <span class="s2">&quot;auth_strategy=keystone&quot;</span>
    add_nova_opt <span class="s2">&quot;allow_resize_to_same_host=True&quot;</span>
    add_nova_opt <span class="s2">&quot;api_paste_config=$NOVA_API_PASTE_INI&quot;</span>
    add_nova_opt <span class="s2">&quot;rootwrap_config=$NOVA_CONF_DIR/rootwrap.conf&quot;</span>
    add_nova_opt <span class="s2">&quot;compute_scheduler_driver=$SCHEDULER&quot;</span>
    add_nova_opt <span class="s2">&quot;dhcpbridge_flagfile=$NOVA_CONF&quot;</span>
    add_nova_opt <span class="s2">&quot;force_dhcp_release=True&quot;</span>
    add_nova_opt <span class="s2">&quot;fixed_range=$FIXED_RANGE&quot;</span>
    add_nova_opt <span class="s2">&quot;s3_host=$SERVICE_HOST&quot;</span>
    add_nova_opt <span class="s2">&quot;s3_port=$S3_SERVICE_PORT&quot;</span>
    add_nova_opt <span class="s2">&quot;osapi_compute_extension=nova.api.openstack.compute.contrib.standard_extensions&quot;</span>
    add_nova_opt <span class="s2">&quot;my_ip=$HOST_IP&quot;</span>
    add_nova_opt <span class="s2">&quot;sql_connection=$BASE_SQL_CONN/nova?charset=utf8&quot;</span>
    add_nova_opt <span class="s2">&quot;libvirt_type=$LIBVIRT_TYPE&quot;</span>
    add_nova_opt <span class="s2">&quot;libvirt_cpu_mode=none&quot;</span>
    add_nova_opt <span class="s2">&quot;instance_name_template=${INSTANCE_NAME_PREFIX}%08x&quot;</span>
    add_nova_opt <span class="s2">&quot;image_service=nova.image.glance.GlanceImageService&quot;</span>

    <span class="k">if </span>is_service_enabled n-api; <span class="k">then</span>
<span class="k">        </span>add_nova_opt <span class="s2">&quot;enabled_apis=$NOVA_ENABLED_APIS&quot;</span>
    <span class="k">fi</span>
<span class="k">    if </span>is_service_enabled n-vol; <span class="k">then</span>
<span class="k">        </span>add_nova_opt <span class="s2">&quot;volume_api_class=nova.volume.api.API&quot;</span>
        add_nova_opt <span class="s2">&quot;volume_group=$VOLUME_GROUP&quot;</span>
        add_nova_opt <span class="s2">&quot;volume_name_template=${VOLUME_NAME_PREFIX}%s&quot;</span>
</pre></div></td></tr><tr><td class=docs>
<p>oneiric no longer supports ietadm</p>
</td><td class=code><div class=highlight><pre>
        add_nova_opt <span class="s2">&quot;iscsi_helper=tgtadm&quot;</span>
    <span class="k">fi</span>
<span class="k">    if </span>is_service_enabled cinder; <span class="k">then</span>
<span class="k">        </span>add_nova_opt <span class="s2">&quot;volume_api_class=nova.volume.cinder.API&quot;</span>
    <span class="k">fi</span>
<span class="k">    if</span> <span class="o">[</span> -n <span class="s2">&quot;$NOVA_STATE_PATH&quot;</span> <span class="o">]</span>; <span class="k">then</span>
<span class="k">        </span>add_nova_opt <span class="s2">&quot;state_path=$NOVA_STATE_PATH&quot;</span>
    <span class="k">fi</span>
<span class="k">    if</span> <span class="o">[</span> -n <span class="s2">&quot;$NOVA_INSTANCES_PATH&quot;</span> <span class="o">]</span>; <span class="k">then</span>
<span class="k">        </span>add_nova_opt <span class="s2">&quot;instances_path=$NOVA_INSTANCES_PATH&quot;</span>
    <span class="k">fi</span>
<span class="k">    if</span> <span class="o">[</span> <span class="s2">&quot;$MULTI_HOST&quot;</span> !<span class="o">=</span> <span class="s2">&quot;False&quot;</span> <span class="o">]</span>; <span class="k">then</span>
<span class="k">        </span>add_nova_opt <span class="s2">&quot;multi_host=True&quot;</span>
        add_nova_opt <span class="s2">&quot;send_arp_for_ha=True&quot;</span>
    <span class="k">fi</span>
<span class="k">    if</span> <span class="o">[</span> <span class="s2">&quot;$SYSLOG&quot;</span> !<span class="o">=</span> <span class="s2">&quot;False&quot;</span> <span class="o">]</span>; <span class="k">then</span>
<span class="k">        </span>add_nova_opt <span class="s2">&quot;use_syslog=True&quot;</span>
    <span class="k">fi</span>
<span class="k">    if</span> <span class="o">[</span> <span class="s2">&quot;$API_RATE_LIMIT&quot;</span> !<span class="o">=</span> <span class="s2">&quot;True&quot;</span> <span class="o">]</span>; <span class="k">then</span>
<span class="k">        </span>add_nova_opt <span class="s2">&quot;api_rate_limit=False&quot;</span>
    <span class="k">fi</span>
<span class="k">    if</span> <span class="o">[</span> <span class="s2">&quot;$LOG_COLOR&quot;</span> <span class="o">==</span> <span class="s2">&quot;True&quot;</span> <span class="o">]</span> <span class="o">&amp;&amp;</span> <span class="o">[</span> <span class="s2">&quot;$SYSLOG&quot;</span> <span class="o">==</span> <span class="s2">&quot;False&quot;</span> <span class="o">]</span>; <span class="k">then</span>
</pre></div></td></tr><tr><td class=docs>
<p>Add color to logging output</p>
</td><td class=code><div class=highlight><pre>
        add_nova_opt <span class="s2">&quot;logging_context_format_string=%(asctime)s %(color)s%(levelname)s %(name)s [[01;36m%(request_id)s [00;36m%(user_name)s %(project_name)s%(color)s] [01;35m%(instance)s%(color)s%(message)s[00m&quot;</span>
        add_nova_opt <span class="s2">&quot;logging_default_format_string=%(asctime)s %(color)s%(levelname)s %(name)s [[00;36m-%(color)s] [01;35m%(instance)s%(color)s%(message)s[00m&quot;</span>
        add_nova_opt <span class="s2">&quot;logging_debug_format_suffix=[00;33mfrom (pid=%(process)d) %(funcName)s %(pathname)s:%(lineno)d[00m&quot;</span>
        add_nova_opt <span class="s2">&quot;logging_exception_prefix=%(color)s%(asctime)s TRACE %(name)s [01;35m%(instance)s[00m&quot;</span>
    <span class="k">else</span>
</pre></div></td></tr><tr><td class=docs>
<p>Show user_name and project_name instead of user_id and project_id</p>
</td><td class=code><div class=highlight><pre>
        add_nova_opt <span class="s2">&quot;logging_context_format_string=%(asctime)s %(levelname)s %(name)s [%(request_id)s %(user_name)s %(project_name)s] %(instance)s%(message)s&quot;</span>
    <span class="k">fi</span>

</pre></div></td></tr><tr><td class=docs>
<p>Provide some transition from <tt class="docutils literal">EXTRA_FLAGS</tt> to <tt class="docutils literal">EXTRA_OPTS</tt></p>
</td><td class=code><div class=highlight><pre>
    <span class="k">if</span> <span class="o">[[</span> -z <span class="s2">&quot;$EXTRA_OPTS&quot;</span> <span class="o">&amp;&amp;</span> -n <span class="s2">&quot;$EXTRA_FLAGS&quot;</span> <span class="o">]]</span>; <span class="k">then</span>
<span class="k">        </span><span class="nv">EXTRA_OPTS</span><span class="o">=</span><span class="nv">$EXTRA_FLAGS</span>
    <span class="k">fi</span>

</pre></div></td></tr><tr><td class=docs>
<p>Define extra nova conf flags by defining the array <tt class="docutils literal">EXTRA_OPTS</tt>.
For Example: <tt class="docutils literal"><span class="pre">EXTRA_OPTS=(foo=true</span> bar=2)</tt></p>
</td><td class=code><div class=highlight><pre>
    <span class="k">for </span>I in <span class="s2">&quot;${EXTRA_OPTS[@]}&quot;</span>; <span class="k">do</span>
</pre></div></td></tr><tr><td class=docs>
<p>Attempt to convert flags to options</p>
</td><td class=code><div class=highlight><pre>
        add_nova_opt <span class="k">${</span><span class="nv">I</span><span class="p">//--</span><span class="k">}</span>
    <span class="k">done</span>

</pre></div></td></tr><tr><td class=docs>
</div>
<div class="section" id="nova-database">
<h1>Nova Database</h1>
</td><td class=code><div class=highlight><pre>

</pre></div></td></tr><tr><td class=docs>
<p>All nova components talk to a central database.  We will need to do this step
only once for an entire cluster.</p>
</td><td class=code><div class=highlight><pre>

    <span class="k">if </span>is_service_enabled mysql <span class="o">&amp;&amp;</span> is_service_enabled nova; <span class="k">then</span>
</pre></div></td></tr><tr><td class=docs>
<p>(Re)create nova database</p>
</td><td class=code><div class=highlight><pre>
        mysql -u<span class="nv">$MYSQL_USER</span> -p<span class="nv">$MYSQL_PASSWORD</span> -e <span class="s1">&#39;DROP DATABASE IF EXISTS nova;&#39;</span>

</pre></div></td></tr><tr><td class=docs>
<p>Explicitly use latin1: to avoid lp#829209, nova expects the database to
use latin1 by default, and then upgrades the database to utf8 (see the
082_essex.py in nova)</p>
</td><td class=code><div class=highlight><pre>
        mysql -u<span class="nv">$MYSQL_USER</span> -p<span class="nv">$MYSQL_PASSWORD</span> -e <span class="s1">&#39;CREATE DATABASE nova CHARACTER SET latin1;&#39;</span>

</pre></div></td></tr><tr><td class=docs>
<p>(Re)create nova database</p>
</td><td class=code><div class=highlight><pre>
        <span class="nv">$NOVA_BIN_DIR</span>/nova-manage db sync
    <span class="k">fi</span>

<span class="o">}</span>

</pre></div></td></tr><tr><td class=docs>
<p>install_novaclient() - Collect source and prepare</p>
</td><td class=code><div class=highlight><pre>
<span class="k">function </span>install_novaclient<span class="o">()</span> <span class="o">{</span>
    git_clone <span class="nv">$NOVACLIENT_REPO</span> <span class="nv">$NOVACLIENT_DIR</span> <span class="nv">$NOVACLIENT_BRANCH</span>
<span class="o">}</span>

</pre></div></td></tr><tr><td class=docs>
<p>install_nova() - Collect source and prepare</p>
</td><td class=code><div class=highlight><pre>
<span class="k">function </span>install_nova<span class="o">()</span> <span class="o">{</span>
    <span class="k">if </span>is_service_enabled n-cpu; <span class="k">then</span>
<span class="k">        if</span> <span class="o">[[</span> <span class="s2">&quot;$os_PACKAGE&quot;</span> <span class="o">=</span> <span class="s2">&quot;deb&quot;</span> <span class="o">]]</span>; <span class="k">then</span>
<span class="k">            </span><span class="nv">LIBVIRT_PKG_NAME</span><span class="o">=</span>libvirt-bin
        <span class="k">else</span>
<span class="k">            </span><span class="nv">LIBVIRT_PKG_NAME</span><span class="o">=</span>libvirt
        <span class="k">fi</span>
<span class="k">        </span>install_package <span class="nv">$LIBVIRT_PKG_NAME</span>
</pre></div></td></tr><tr><td class=docs>
<p>Install and configure <strong>LXC</strong> if specified.  LXC is another approach to
splitting a system into many smaller parts.  LXC uses cgroups and chroot
to simulate multiple systems.</p>
</td><td class=code><div class=highlight><pre>
        <span class="k">if</span> <span class="o">[[</span> <span class="s2">&quot;$LIBVIRT_TYPE&quot;</span> <span class="o">==</span> <span class="s2">&quot;lxc&quot;</span> <span class="o">]]</span>; <span class="k">then</span>
<span class="k">            if</span> <span class="o">[[</span> <span class="s2">&quot;$os_PACKAGE&quot;</span> <span class="o">=</span> <span class="s2">&quot;deb&quot;</span> <span class="o">]]</span>; <span class="k">then</span>
<span class="k">                if</span> <span class="o">[[</span> <span class="s2">&quot;$DISTRO&quot;</span> &gt; natty <span class="o">]]</span>; <span class="k">then</span>
<span class="k">                    </span>install_package cgroup-lite
                <span class="k">fi</span>
<span class="k">            else</span>
                <span class="c">### FIXME(dtroyer): figure this out</span>
                <span class="nb">echo</span> <span class="s2">&quot;RPM-based cgroup not implemented yet&quot;</span>
                yum_install libcgroup-tools
            <span class="k">fi</span>
<span class="k">        fi</span>
<span class="k">    fi</span>

<span class="k">    </span>git_clone <span class="nv">$NOVA_REPO</span> <span class="nv">$NOVA_DIR</span> <span class="nv">$NOVA_BRANCH</span>
<span class="o">}</span>

</pre></div></td></tr><tr><td class=docs>
<p>start_nova() - Start running processes, including screen</p>
</td><td class=code><div class=highlight><pre>
<span class="k">function </span>start_nova<span class="o">()</span> <span class="o">{</span>
</pre></div></td></tr><tr><td class=docs>
<p>The group <strong>libvirtd</strong> is added to the current user in this script.
Use 'sg' to execute nova-compute as a member of the <strong>libvirtd</strong> group.
<tt class="docutils literal">screen_it</tt> checks <tt class="docutils literal">is_service_enabled</tt>, it is not needed here</p>
</td><td class=code><div class=highlight><pre>
    screen_it n-cpu <span class="s2">&quot;cd $NOVA_DIR &amp;&amp; sg libvirtd $NOVA_BIN_DIR/nova-compute&quot;</span>
    screen_it n-crt <span class="s2">&quot;cd $NOVA_DIR &amp;&amp; $NOVA_BIN_DIR/nova-cert&quot;</span>
    screen_it n-net <span class="s2">&quot;cd $NOVA_DIR &amp;&amp; $NOVA_BIN_DIR/nova-network&quot;</span>
    screen_it n-sch <span class="s2">&quot;cd $NOVA_DIR &amp;&amp; $NOVA_BIN_DIR/nova-scheduler&quot;</span>
    screen_it n-novnc <span class="s2">&quot;cd $NOVNC_DIR &amp;&amp; ./utils/nova-novncproxy --config-file $NOVA_CONF --web .&quot;</span>
    screen_it n-xvnc <span class="s2">&quot;cd $NOVA_DIR &amp;&amp; ./bin/nova-xvpvncproxy --config-file $NOVA_CONF&quot;</span>
    screen_it n-cauth <span class="s2">&quot;cd $NOVA_DIR &amp;&amp; ./bin/nova-consoleauth&quot;</span>
<span class="o">}</span>

</pre></div></td></tr><tr><td class=docs>
<p>stop_nova() - Stop running processes (non-screen)</p>
</td><td class=code><div class=highlight><pre>
<span class="k">function </span>stop_nova<span class="o">()</span> <span class="o">{</span>
</pre></div></td></tr><tr><td class=docs>
<p>Kill the nova screen windows</p>
</td><td class=code><div class=highlight><pre>
    <span class="k">for </span>serv in n-api n-cpu n-crt n-net n-sch n-novnc n-xvnc n-cauth; <span class="k">do</span>
<span class="k">        </span>screen -S <span class="nv">$SCREEN_NAME</span> -p <span class="nv">$serv</span> -X <span class="nb">kill</span>
<span class="nb">    </span><span class="k">done</span>
<span class="o">}</span>

</pre></div></td></tr><tr><td class=docs>
<p>Restore xtrace</p>
</td><td class=code><div class=highlight><pre>
<span class="nv">$XTRACE</span>


</pre></div></td></tr><tr><td class=docs>
</td><td class=code><div class=highlight><pre>

</pre></div></td></tr><tr><td class=docs>
</div>
</div>
</body>
</html></td><td class='code'></td></tr>
    </tbody>
    </table>
</div>
</body>
</html>
