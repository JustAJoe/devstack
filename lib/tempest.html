<!DOCTYPE html>
<html>
<head>
    <meta http-eqiv='content-type' content='text/html;charset=utf-8'>
    <title>tempest</title>
    <link rel=stylesheet href="http://jashkenas.github.com/docco/resources/docco.css">
</head>
<body>
<div id=container>
    <div id=background></div>
    <table cellspacing=0 cellpadding=0>
    <thead>
      <tr>
        <th class=docs><h1>tempest</h1></th>
        <th class=code></th>
      </tr>
    </thead>
    <tbody>
        <tr><td class='docs'><?xml version="1.0" encoding="utf-8" ?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="generator" content="Docutils 0.7: http://docutils.sourceforge.net/" />
<title></title>
<style type="text/css">

/*
:Author: David Goodger (goodger@python.org)
:Id: $Id: html4css1.css 6253 2010-03-02 00:24:53Z milde $
:Copyright: This stylesheet has been placed in the public domain.

Default cascading style sheet for the HTML output of Docutils.

See http://docutils.sf.net/docs/howto/html-stylesheets.html for how to
customize this style sheet.
*/

/* used to remove borders from tables and images */
.borderless, table.borderless td, table.borderless th {
  border: 0 }

table.borderless td, table.borderless th {
  /* Override padding for "table.docutils td" with "! important".
     The right padding separates the table cells. */
  padding: 0 0.5em 0 0 ! important }

.first {
  /* Override more specific margin styles with "! important". */
  margin-top: 0 ! important }

.last, .with-subtitle {
  margin-bottom: 0 ! important }

.hidden {
  display: none }

a.toc-backref {
  text-decoration: none ;
  color: black }

blockquote.epigraph {
  margin: 2em 5em ; }

dl.docutils dd {
  margin-bottom: 0.5em }

/* Uncomment (and remove this text!) to get bold-faced definition list terms
dl.docutils dt {
  font-weight: bold }
*/

div.abstract {
  margin: 2em 5em }

div.abstract p.topic-title {
  font-weight: bold ;
  text-align: center }

div.admonition, div.attention, div.caution, div.danger, div.error,
div.hint, div.important, div.note, div.tip, div.warning {
  margin: 2em ;
  border: medium outset ;
  padding: 1em }

div.admonition p.admonition-title, div.hint p.admonition-title,
div.important p.admonition-title, div.note p.admonition-title,
div.tip p.admonition-title {
  font-weight: bold ;
  font-family: sans-serif }

div.attention p.admonition-title, div.caution p.admonition-title,
div.danger p.admonition-title, div.error p.admonition-title,
div.warning p.admonition-title {
  color: red ;
  font-weight: bold ;
  font-family: sans-serif }

/* Uncomment (and remove this text!) to get reduced vertical space in
   compound paragraphs.
div.compound .compound-first, div.compound .compound-middle {
  margin-bottom: 0.5em }

div.compound .compound-last, div.compound .compound-middle {
  margin-top: 0.5em }
*/

div.dedication {
  margin: 2em 5em ;
  text-align: center ;
  font-style: italic }

div.dedication p.topic-title {
  font-weight: bold ;
  font-style: normal }

div.figure {
  margin-left: 2em ;
  margin-right: 2em }

div.footer, div.header {
  clear: both;
  font-size: smaller }

div.line-block {
  display: block ;
  margin-top: 1em ;
  margin-bottom: 1em }

div.line-block div.line-block {
  margin-top: 0 ;
  margin-bottom: 0 ;
  margin-left: 1.5em }

div.sidebar {
  margin: 0 0 0.5em 1em ;
  border: medium outset ;
  padding: 1em ;
  background-color: #ffffee ;
  width: 40% ;
  float: right ;
  clear: right }

div.sidebar p.rubric {
  font-family: sans-serif ;
  font-size: medium }

div.system-messages {
  margin: 5em }

div.system-messages h1 {
  color: red }

div.system-message {
  border: medium outset ;
  padding: 1em }

div.system-message p.system-message-title {
  color: red ;
  font-weight: bold }

div.topic {
  margin: 2em }

h1.section-subtitle, h2.section-subtitle, h3.section-subtitle,
h4.section-subtitle, h5.section-subtitle, h6.section-subtitle {
  margin-top: 0.4em }

h1.title {
  text-align: center }

h2.subtitle {
  text-align: center }

hr.docutils {
  width: 75% }

img.align-left, .figure.align-left, object.align-left {
  clear: left ;
  float: left ;
  margin-right: 1em }

img.align-right, .figure.align-right, object.align-right {
  clear: right ;
  float: right ;
  margin-left: 1em }

img.align-center, .figure.align-center, object.align-center {
  display: block;
  margin-left: auto;
  margin-right: auto;
}

.align-left {
  text-align: left }

.align-center {
  clear: both ;
  text-align: center }

.align-right {
  text-align: right }

/* reset inner alignment in figures */
div.align-right {
  text-align: left }

/* div.align-center * { */
/*   text-align: left } */

ol.simple, ul.simple {
  margin-bottom: 1em }

ol.arabic {
  list-style: decimal }

ol.loweralpha {
  list-style: lower-alpha }

ol.upperalpha {
  list-style: upper-alpha }

ol.lowerroman {
  list-style: lower-roman }

ol.upperroman {
  list-style: upper-roman }

p.attribution {
  text-align: right ;
  margin-left: 50% }

p.caption {
  font-style: italic }

p.credits {
  font-style: italic ;
  font-size: smaller }

p.label {
  white-space: nowrap }

p.rubric {
  font-weight: bold ;
  font-size: larger ;
  color: maroon ;
  text-align: center }

p.sidebar-title {
  font-family: sans-serif ;
  font-weight: bold ;
  font-size: larger }

p.sidebar-subtitle {
  font-family: sans-serif ;
  font-weight: bold }

p.topic-title {
  font-weight: bold }

pre.address {
  margin-bottom: 0 ;
  margin-top: 0 ;
  font: inherit }

pre.literal-block, pre.doctest-block {
  margin-left: 2em ;
  margin-right: 2em }

span.classifier {
  font-family: sans-serif ;
  font-style: oblique }

span.classifier-delimiter {
  font-family: sans-serif ;
  font-weight: bold }

span.interpreted {
  font-family: sans-serif }

span.option {
  white-space: nowrap }

span.pre {
  white-space: pre }

span.problematic {
  color: red }

span.section-subtitle {
  /* font-size relative to parent (h1..h6 element) */
  font-size: 80% }

table.citation {
  border-left: solid 1px gray;
  margin-left: 1px }

table.docinfo {
  margin: 2em 4em }

table.docutils {
  margin-top: 0.5em ;
  margin-bottom: 0.5em }

table.footnote {
  border-left: solid 1px black;
  margin-left: 1px }

table.docutils td, table.docutils th,
table.docinfo td, table.docinfo th {
  padding-left: 0.5em ;
  padding-right: 0.5em ;
  vertical-align: top }

table.docutils th.field-name, table.docinfo th.docinfo-name {
  font-weight: bold ;
  text-align: left ;
  white-space: nowrap ;
  padding-left: 0 }

h1 tt.docutils, h2 tt.docutils, h3 tt.docutils,
h4 tt.docutils, h5 tt.docutils, h6 tt.docutils {
  font-size: 100% }

ul.auto-toc {
  list-style-type: none }

</style>
</head>
<body>
<div class="document">


<p>lib/tempest
Install and configure Tempest
Dependencies:
<tt class="docutils literal">functions</tt> file
<tt class="docutils literal">lib/nova</tt> service is runing
&lt;list other global vars that are assumed to be defined&gt;
- <tt class="docutils literal">DEST</tt>, <tt class="docutils literal">FILES</tt>
- <tt class="docutils literal">ADMIN_PASSWORD</tt>
- <tt class="docutils literal">DEFAULT_IMAGE_NAME</tt>
- <tt class="docutils literal">S3_SERVICE_PORT</tt>
- <tt class="docutils literal">SERVICE_HOST</tt>
- <tt class="docutils literal">BASE_SQL_CONN</tt> <tt class="docutils literal">lib/database</tt> declares
- <tt class="docutils literal">PUBLIC_NETWORK_NAME</tt>
- <tt class="docutils literal">Q_USE_NAMESPACE</tt>
- <tt class="docutils literal">Q_ROUTER_NAME</tt>
- <tt class="docutils literal">VIRT_DRIVER</tt>
- <tt class="docutils literal">LIBVIRT_TYPE</tt>
- <tt class="docutils literal">KEYSTONE_SERVICE_PROTOCOL</tt>, <tt class="docutils literal">KEYSTONE_SERVICE_HOST</tt> from lib/keystone
Optional Dependencies:
ALT_* (similar vars exists in keystone_data.sh)
<tt class="docutils literal">LIVE_MIGRATION_AVAILABLE</tt>
<tt class="docutils literal">USE_BLOCK_MIGRATION_FOR_LIVE_MIGRATION</tt>
<tt class="docutils literal">DEFAULT_INSTANCE_TYPE</tt>
<tt class="docutils literal">DEFAULT_INSTANCE_USER</tt>
<tt class="docutils literal">stack.sh</tt> calls the entry points in this order:</p>
<p>install_tempest
configure_tempest
init_tempest</p>
</td><td class=code><div class=highlight><pre>


</pre></div></td></tr><tr><td class=docs>
<p>Save trace setting</p>
</td><td class=code><div class=highlight><pre>
<span class="nv">XTRACE</span><span class="o">=</span><span class="k">$(</span><span class="nb">set</span> +o | grep xtrace<span class="k">)</span>
<span class="nb">set</span> +o xtrace


</pre></div></td></tr><tr><td class=docs>
<div class="section" id="defaults">
<h1>Defaults</h1>
</td><td class=code><div class=highlight><pre>

</pre></div></td></tr><tr><td class=docs>
<p>Set up default directories</p>
</td><td class=code><div class=highlight><pre>
<span class="nv">TEMPEST_DIR</span><span class="o">=</span><span class="nv">$DEST</span>/tempest
<span class="nv">TEMPEST_CONF_DIR</span><span class="o">=</span><span class="nv">$TEMPEST_DIR</span>/etc
<span class="nv">TEMPEST_CONF</span><span class="o">=</span><span class="nv">$TEMPEST_CONF_DIR</span>/tempest.conf

<span class="nv">NOVA_SOURCE_DIR</span><span class="o">=</span><span class="nv">$DEST</span>/nova

<span class="nv">BUILD_INTERVAL</span><span class="o">=</span>3
<span class="nv">BUILD_TIMEOUT</span><span class="o">=</span>400


<span class="nv">BOTO_MATERIALS_PATH</span><span class="o">=</span><span class="s2">&quot;$FILES/images/s3-materials/cirros-0.3.0&quot;</span>

</pre></div></td></tr><tr><td class=docs>
</div>
<div class="section" id="entry-points">
<h1>Entry Points</h1>
</td><td class=code><div class=highlight><pre>

</pre></div></td></tr><tr><td class=docs>
<p>configure_tempest() - Set config files, create data dirs, etc</p>
</td><td class=code><div class=highlight><pre>
<span class="k">function </span>configure_tempest<span class="o">()</span> <span class="o">{</span>
    setup_develop <span class="nv">$TEMPEST_DIR</span>
    <span class="nb">local </span>image_lines
    <span class="nb">local </span>images
    <span class="nb">local </span>num_images
    <span class="nb">local </span>image_uuid
    <span class="nb">local </span>image_uuid_alt
    <span class="nb">local </span>errexit
    <span class="nb">local </span>password
    <span class="nb">local </span>line
    <span class="nb">local </span>flavors
    <span class="nb">local </span>flavors_ref
    <span class="nb">local </span>flavor_lines
    <span class="nb">local </span>public_network_id
    <span class="nb">local </span>public_router_id
    <span class="nb">local </span>tenant_networks_reachable
    <span class="nb">local </span><span class="nv">boto_instance_type</span><span class="o">=</span><span class="s2">&quot;m1.tiny&quot;</span>

</pre></div></td></tr><tr><td class=docs>
<p>TODO(afazekas):
sudo python setup.py deploy</p>
</td><td class=code><div class=highlight><pre>

</pre></div></td></tr><tr><td class=docs>
<p>This function exits on an error so that errors don't compound and you see
only the first error that occured.</p>
</td><td class=code><div class=highlight><pre>
    <span class="nv">errexit</span><span class="o">=</span><span class="k">$(</span><span class="nb">set</span> +o | grep errexit<span class="k">)</span>
    <span class="nb">set</span> -o errexit

</pre></div></td></tr><tr><td class=docs>
<p>Save IFS</p>
</td><td class=code><div class=highlight><pre>
    <span class="nv">ifs</span><span class="o">=</span><span class="nv">$IFS</span>

</pre></div></td></tr><tr><td class=docs>
<p>Glance should already contain images to be used in tempest
testing. Here we simply look for images stored in Glance
and set the appropriate variables for use in the tempest config
We ignore ramdisk and kernel images, look for the default image
<tt class="docutils literal">DEFAULT_IMAGE_NAME</tt>. If not found, we set the <tt class="docutils literal">image_uuid</tt> to the
first image returned and set <tt class="docutils literal">image_uuid_alt</tt> to the second,
if there is more than one returned...
... Also ensure we only take active images, so we don't get snapshots in process</p>
</td><td class=code><div class=highlight><pre>
    <span class="nb">declare</span> -a images

    <span class="k">while </span><span class="nb">read</span> -r IMAGE_NAME IMAGE_UUID; <span class="k">do</span>
<span class="k">        if</span> <span class="o">[</span> <span class="s2">&quot;$IMAGE_NAME&quot;</span> <span class="o">=</span> <span class="s2">&quot;$DEFAULT_IMAGE_NAME&quot;</span> <span class="o">]</span>; <span class="k">then</span>
<span class="k">            </span><span class="nv">image_uuid</span><span class="o">=</span><span class="s2">&quot;$IMAGE_UUID&quot;</span>
            <span class="nv">image_uuid_alt</span><span class="o">=</span><span class="s2">&quot;$IMAGE_UUID&quot;</span>
        <span class="k">fi</span>
<span class="k">        </span>images+<span class="o">=(</span><span class="nv">$IMAGE_UUID</span><span class="o">)</span>
    <span class="k">done</span> &lt; &lt;<span class="o">(</span>glance image-list --status<span class="o">=</span>active | awk -F<span class="s1">&#39;|&#39;</span> <span class="s1">&#39;!/^(+--)|ID|aki|ari/ { print $3,$2 }&#39;</span><span class="o">)</span>

    <span class="k">case</span> <span class="s2">&quot;${#images[*]}&quot;</span> in
        0<span class="o">)</span>
            <span class="nb">echo</span> <span class="s2">&quot;Found no valid images to use!&quot;</span>
            <span class="nb">exit </span>1
            ;;
        1<span class="o">)</span>
            <span class="k">if</span> <span class="o">[</span> -z <span class="s2">&quot;$image_uuid&quot;</span> <span class="o">]</span>; <span class="k">then</span>
<span class="k">                </span><span class="nv">image_uuid</span><span class="o">=</span><span class="k">${</span><span class="nv">images</span><span class="p">[0]</span><span class="k">}</span>
                <span class="nv">image_uuid_alt</span><span class="o">=</span><span class="k">${</span><span class="nv">images</span><span class="p">[0]</span><span class="k">}</span>
            <span class="k">fi</span>
            ;;
        *<span class="o">)</span>
            <span class="k">if</span> <span class="o">[</span> -z <span class="s2">&quot;$image_uuid&quot;</span> <span class="o">]</span>; <span class="k">then</span>
<span class="k">                </span><span class="nv">image_uuid</span><span class="o">=</span><span class="k">${</span><span class="nv">images</span><span class="p">[0]</span><span class="k">}</span>
                <span class="nv">image_uuid_alt</span><span class="o">=</span><span class="k">${</span><span class="nv">images</span><span class="p">[1]</span><span class="k">}</span>
            <span class="k">fi</span>
            ;;
    <span class="k">esac</span>

</pre></div></td></tr><tr><td class=docs>
<p>Create tempest.conf from tempest.conf.sample
copy every time, because the image UUIDS are going to change</p>
</td><td class=code><div class=highlight><pre>
    cp <span class="nv">$TEMPEST_CONF</span>.sample <span class="nv">$TEMPEST_CONF</span>

    <span class="nv">password</span><span class="o">=</span><span class="k">${</span><span class="nv">ADMIN_PASSWORD</span><span class="k">:-</span><span class="nv">secrete</span><span class="k">}</span>

</pre></div></td></tr><tr><td class=docs>
<p>See files/keystone_data.sh where alt_demo user
and tenant are set up...</p>
</td><td class=code><div class=highlight><pre>
    <span class="nv">ALT_USERNAME</span><span class="o">=</span><span class="k">${</span><span class="nv">ALT_USERNAME</span><span class="k">:-</span><span class="nv">alt_demo</span><span class="k">}</span>
    <span class="nv">ALT_TENANT_NAME</span><span class="o">=</span><span class="k">${</span><span class="nv">ALT_TENANT_NAME</span><span class="k">:-</span><span class="nv">alt_demo</span><span class="k">}</span>

</pre></div></td></tr><tr><td class=docs>
<p>If the <tt class="docutils literal">DEFAULT_INSTANCE_TYPE</tt> not declared, use the new behavior
Tempest creates instane types for himself</p>
</td><td class=code><div class=highlight><pre>
    <span class="k">if</span>  <span class="o">[[</span> -z <span class="s2">&quot;$DEFAULT_INSTANCE_TYPE&quot;</span> <span class="o">]]</span>; <span class="k">then</span>
<span class="k">        </span>nova flavor-create m1.nano 42 64 0 1
        <span class="nv">flavor_ref</span><span class="o">=</span>42
        <span class="nv">boto_instance_type</span><span class="o">=</span>m1.nano
        nova flavor-create m1.micro 84 128 0 1
        <span class="nv">flavor_ref_alt</span><span class="o">=</span>84
    <span class="k">else</span>
</pre></div></td></tr><tr><td class=docs>
<p>Check Nova for existing flavors and, if set, look for the
<tt class="docutils literal">DEFAULT_INSTANCE_TYPE</tt> and use that.</p>
</td><td class=code><div class=highlight><pre>
        <span class="nv">boto_instance_type</span><span class="o">=</span><span class="nv">$DEFAULT_INSTANCE_TYPE</span>
        <span class="nv">flavor_lines</span><span class="o">=</span><span class="sb">`</span>nova flavor-list<span class="sb">`</span>
        <span class="nv">IFS</span><span class="o">=</span><span class="s1">$&#39;\r\n&#39;</span>
        <span class="nv">flavors</span><span class="o">=</span><span class="s2">&quot;&quot;</span>
        <span class="k">for </span>line in <span class="nv">$flavor_lines</span>; <span class="k">do</span>
<span class="k">            </span><span class="nv">f</span><span class="o">=</span><span class="k">$(</span><span class="nb">echo</span> <span class="nv">$line</span> | awk <span class="s2">&quot;/ $DEFAULT_INSTANCE_TYPE / { print \$2 }&quot;</span><span class="k">)</span>
            <span class="nv">flavors</span><span class="o">=</span><span class="s2">&quot;$flavors $f&quot;</span>
        <span class="k">done</span>

<span class="k">        for </span>line in <span class="nv">$flavor_lines</span>; <span class="k">do</span>
<span class="k">            </span><span class="nv">flavors</span><span class="o">=</span><span class="s2">&quot;$flavors `echo $line | grep -v &quot;</span>^<span class="se">\(</span>|<span class="se">\s</span>*ID<span class="se">\|</span>+--<span class="se">\)</span><span class="s2">&quot; | cut -d&#39; &#39; -f2`&quot;</span>
        <span class="k">done</span>

<span class="k">        </span><span class="nv">IFS</span><span class="o">=</span><span class="s2">&quot; &quot;</span>
        <span class="nv">flavors</span><span class="o">=(</span><span class="nv">$flavors</span><span class="o">)</span>
        <span class="nv">num_flavors</span><span class="o">=</span><span class="k">${#</span><span class="nv">flavors</span><span class="p">[*]</span><span class="k">}</span>
        <span class="nb">echo</span> <span class="s2">&quot;Found $num_flavors flavors&quot;</span>
        <span class="k">if</span> <span class="o">[[</span> <span class="nv">$num_flavors</span> -eq 0 <span class="o">]]</span>; <span class="k">then</span>
<span class="k">            </span><span class="nb">echo</span> <span class="s2">&quot;Found no valid flavors to use!&quot;</span>
            <span class="nb">exit </span>1
        <span class="k">fi</span>
<span class="k">        </span><span class="nv">flavor_ref</span><span class="o">=</span><span class="k">${</span><span class="nv">flavors</span><span class="p">[0]</span><span class="k">}</span>
        <span class="nv">flavor_ref_alt</span><span class="o">=</span><span class="nv">$flavor_ref</span>
        <span class="k">if</span> <span class="o">[[</span> <span class="nv">$num_flavors</span> -gt 1 <span class="o">]]</span>; <span class="k">then</span>
<span class="k">            </span><span class="nv">flavor_ref_alt</span><span class="o">=</span><span class="k">${</span><span class="nv">flavors</span><span class="p">[1]</span><span class="k">}</span>
        <span class="k">fi</span>
<span class="k">    fi</span>

<span class="k">    if</span> <span class="o">[</span> <span class="s2">&quot;$Q_USE_NAMESPACE&quot;</span> !<span class="o">=</span> <span class="s2">&quot;False&quot;</span> <span class="o">]</span>; <span class="k">then</span>
<span class="k">        </span><span class="nv">tenant_networks_reachable</span><span class="o">=</span><span class="nb">false</span>
<span class="nb">    </span><span class="k">else</span>
<span class="k">        </span><span class="nv">tenant_networks_reachable</span><span class="o">=</span><span class="nb">true</span>
<span class="nb">    </span><span class="k">fi</span>

<span class="k">    if </span>is_service_enabled q-l3; <span class="k">then</span>
<span class="k">        </span><span class="nv">public_network_id</span><span class="o">=</span><span class="k">$(</span>quantum net-list | grep <span class="nv">$PUBLIC_NETWORK_NAME</span> | <span class="se">\</span>
            awk <span class="s1">&#39;{print $2}&#39;</span><span class="k">)</span>
        <span class="k">if</span> <span class="o">[</span> <span class="s2">&quot;$Q_USE_NAMESPACE&quot;</span> <span class="o">==</span> <span class="s2">&quot;False&quot;</span> <span class="o">]</span>; <span class="k">then</span>
</pre></div></td></tr><tr><td class=docs>
<p>If namespaces are disabled, devstack will create a single
public router that tempest should be configured to use.</p>
</td><td class=code><div class=highlight><pre>
            <span class="nv">public_router_id</span><span class="o">=</span><span class="k">$(</span>quantum router-list | awk <span class="s2">&quot;/ $Q_ROUTER_NAME / \</span>
<span class="s2">               { print \$2 }&quot;</span><span class="k">)</span>
        <span class="k">fi</span>
<span class="k">    fi</span>

</pre></div></td></tr><tr><td class=docs>
<p>Timeouts</p>
</td><td class=code><div class=highlight><pre>
    iniset <span class="nv">$TEMPEST_CONF</span> compute build_timeout <span class="nv">$BUILD_TIMEOUT</span>
    iniset <span class="nv">$TEMPEST_CONF</span> volume build_timeout <span class="nv">$BUILD_TIMEOUT</span>
    iniset <span class="nv">$TEMPEST_CONF</span> boto build_timeout <span class="nv">$BUILD_TIMEOUT</span>
    iniset <span class="nv">$TEMPEST_CONF</span> compute build_interval <span class="nv">$BUILD_INTERVAL</span>
    iniset <span class="nv">$TEMPEST_CONF</span> volume build_interval <span class="nv">$BUILD_INTERVAL</span>
    iniset <span class="nv">$TEMPEST_CONF</span> boto build_interval <span class="nv">$BUILD_INTERVAL</span>
    iniset <span class="nv">$TEMPEST_CONF</span> boto http_socket_timeout 5

</pre></div></td></tr><tr><td class=docs>
<p>Identity</p>
</td><td class=code><div class=highlight><pre>
    iniset <span class="nv">$TEMPEST_CONF</span> identity uri <span class="s2">&quot;$KEYSTONE_SERVICE_PROTOCOL://$KEYSTONE_SERVICE_HOST:5000/v2.0/&quot;</span>
    iniset <span class="nv">$TEMPEST_CONF</span> identity password <span class="s2">&quot;$password&quot;</span>
    iniset <span class="nv">$TEMPEST_CONF</span> identity alt_username <span class="nv">$ALT_USERNAME</span>
    iniset <span class="nv">$TEMPEST_CONF</span> identity alt_password <span class="s2">&quot;$password&quot;</span>
    iniset <span class="nv">$TEMPEST_CONF</span> identity alt_tenant_name <span class="nv">$ALT_TENANT_NAME</span>
    iniset <span class="nv">$TEMPEST_CONF</span> identity admin_password <span class="s2">&quot;$password&quot;</span>

</pre></div></td></tr><tr><td class=docs>
<p>Compute</p>
</td><td class=code><div class=highlight><pre>
    iniset <span class="nv">$TEMPEST_CONF</span> compute password <span class="s2">&quot;$password&quot;</span> <span class="c"># DEPRECATED</span>
    iniset <span class="nv">$TEMPEST_CONF</span> compute alt_username <span class="nv">$ALT_USERNAME</span> <span class="c"># DEPRECATED</span>
    iniset <span class="nv">$TEMPEST_CONF</span> compute alt_password <span class="s2">&quot;$password&quot;</span> <span class="c"># DEPRECATED</span>
    iniset <span class="nv">$TEMPEST_CONF</span> compute alt_tenant_name <span class="nv">$ALT_TENANT_NAME</span> <span class="c"># DEPRECATED</span>
    iniset <span class="nv">$TEMPEST_CONF</span> compute change_password_available False
    iniset <span class="nv">$TEMPEST_CONF</span> compute compute_log_level ERROR
</pre></div></td></tr><tr><td class=docs>
<p>Note(nati) current tempest don't create network for each tenant
so reuse same tenant for now</p>
</td><td class=code><div class=highlight><pre>
    <span class="k">if </span>is_service_enabled quantum; <span class="k">then</span>
<span class="k">        </span><span class="nv">TEMPEST_ALLOW_TENANT_ISOLATION</span><span class="o">=</span><span class="k">${</span><span class="nv">TEMPEST_ALLOW_TENANT_ISOLATION</span><span class="k">:-</span><span class="nv">False</span><span class="k">}</span>
    <span class="k">fi</span>
<span class="k">    </span>iniset <span class="nv">$TEMPEST_CONF</span> compute allow_tenant_isolation <span class="k">${</span><span class="nv">TEMPEST_ALLOW_TENANT_ISOLATION</span><span class="k">:-</span><span class="nv">True</span><span class="k">}</span>
    <span class="c">#Skip until #1074039 is fixed</span>
    iniset <span class="nv">$TEMPEST_CONF</span> compute run_ssh False
    iniset <span class="nv">$TEMPEST_CONF</span> compute ssh_user <span class="k">${</span><span class="nv">DEFAULT_INSTANCE_USER</span><span class="k">:-</span><span class="nv">cirros</span><span class="k">}</span> <span class="c"># DEPRECATED</span>
    iniset <span class="nv">$TEMPEST_CONF</span> compute network_for_ssh <span class="nv">$PRIVATE_NETWORK_NAME</span>
    iniset <span class="nv">$TEMPEST_CONF</span> compute ip_version_for_ssh 4
    iniset <span class="nv">$TEMPEST_CONF</span> compute ssh_timeout <span class="nv">$BUILD_TIMEOUT</span>
    iniset <span class="nv">$TEMPEST_CONF</span> compute image_ref <span class="nv">$image_uuid</span>
    iniset <span class="nv">$TEMPEST_CONF</span> compute image_ssh_user <span class="k">${</span><span class="nv">DEFAULT_INSTANCE_USER</span><span class="k">:-</span><span class="nv">cirros</span><span class="k">}</span>
    iniset <span class="nv">$TEMPEST_CONF</span> compute image_ref_alt <span class="nv">$image_uuid_alt</span>
    iniset <span class="nv">$TEMPEST_CONF</span> compute image_alt_ssh_user <span class="k">${</span><span class="nv">DEFAULT_INSTANCE_USER</span><span class="k">:-</span><span class="nv">cirros</span><span class="k">}</span>
    iniset <span class="nv">$TEMPEST_CONF</span> compute flavor_ref <span class="nv">$flavor_ref</span>
    iniset <span class="nv">$TEMPEST_CONF</span> compute flavor_ref_alt <span class="nv">$flavor_ref_alt</span>
    iniset <span class="nv">$TEMPEST_CONF</span> compute live_migration_available <span class="k">${</span><span class="nv">LIVE_MIGRATION_AVAILABLE</span><span class="k">:-</span><span class="nv">False</span><span class="k">}</span>
    iniset <span class="nv">$TEMPEST_CONF</span> compute use_block_migration_for_live_migration <span class="k">${</span><span class="nv">USE_BLOCK_MIGRATION_FOR_LIVE_MIGRATION</span><span class="k">:-</span><span class="nv">False</span><span class="k">}</span>
    iniset <span class="nv">$TEMPEST_CONF</span> compute source_dir <span class="nv">$NOVA_SOURCE_DIR</span> <span class="c"># DEPRECATED</span>
    iniset <span class="nv">$TEMPEST_CONF</span> compute bin_dir <span class="nv">$NOVA_BIN_DIR</span> <span class="c"># DEPRECATED</span>
    iniset <span class="nv">$TEMPEST_CONF</span> compute path_to_private_key <span class="nv">$TEMPEST_DIR</span>/id_rsa <span class="c"># DEPRECATED</span>
    iniset <span class="nv">$TEMPEST_CONF</span> compute db_uri <span class="nv">$BASE_SQL_CONN</span>/nova <span class="c"># DEPRECATED</span>

</pre></div></td></tr><tr><td class=docs>
<p>Whitebox</p>
</td><td class=code><div class=highlight><pre>
    iniset <span class="nv">$TEMPEST_CONF</span> whitebox source_dir <span class="nv">$NOVA_SOURCE_DIR</span>
    iniset <span class="nv">$TEMPEST_CONF</span> whitebox bin_dir <span class="nv">$NOVA_BIN_DIR</span>
</pre></div></td></tr><tr><td class=docs>
<p>TODO(jaypipes): Create the key file here... right now, no whitebox
tests actually use a key.</p>
</td><td class=code><div class=highlight><pre>
    iniset <span class="nv">$TEMPEST_CONF</span> whitebox path_to_private_key <span class="nv">$TEMPEST_DIR</span>/id_rsa
    iniset <span class="nv">$TEMPEST_CONF</span> whitebox db_uri <span class="nv">$BASE_SQL_CONN</span>/nova


</pre></div></td></tr><tr><td class=docs>
<p>image</p>
</td><td class=code><div class=highlight><pre>
    iniset <span class="nv">$TEMPEST_CONF</span> image password <span class="s2">&quot;$password&quot;</span> <span class="c"># DEPRECATED</span>

</pre></div></td></tr><tr><td class=docs>
<p>identity-admin</p>
</td><td class=code><div class=highlight><pre>
    iniset <span class="nv">$TEMPEST_CONF</span> <span class="s2">&quot;identity-admin&quot;</span> password <span class="s2">&quot;$password&quot;</span> <span class="c"># DEPRECATED</span>

</pre></div></td></tr><tr><td class=docs>
<p>compute admin</p>
</td><td class=code><div class=highlight><pre>
    iniset <span class="nv">$TEMPEST_CONF</span> <span class="s2">&quot;compute-admin&quot;</span> password <span class="s2">&quot;$password&quot;</span> <span class="c"># DEPRECATED</span>

</pre></div></td></tr><tr><td class=docs>
<p>network admin</p>
</td><td class=code><div class=highlight><pre>
    iniset <span class="nv">$TEMPEST_CONF</span> <span class="s2">&quot;network-admin&quot;</span> password <span class="s2">&quot;$password&quot;</span> <span class="c"># DEPRECATED</span>

</pre></div></td></tr><tr><td class=docs>
<p>network</p>
</td><td class=code><div class=highlight><pre>
    iniset <span class="nv">$TEMPEST_CONF</span> network api_version 2.0
    iniset <span class="nv">$TEMPEST_CONF</span> network password <span class="s2">&quot;$password&quot;</span> <span class="c"># DEPRECATED</span>
    iniset <span class="nv">$TEMPEST_CONF</span> network tenant_networks_reachable <span class="s2">&quot;$tenant_networks_reachable&quot;</span>
    iniset <span class="nv">$TEMPEST_CONF</span> network public_network_id <span class="s2">&quot;$public_network_id&quot;</span>
    iniset <span class="nv">$TEMPEST_CONF</span> network public_router_id <span class="s2">&quot;$public_router_id&quot;</span>

    <span class="c">#boto</span>
    iniset <span class="nv">$TEMPEST_CONF</span> boto ec2_url <span class="s2">&quot;http://$SERVICE_HOST:8773/services/Cloud&quot;</span>
    iniset <span class="nv">$TEMPEST_CONF</span> boto s3_url <span class="s2">&quot;http://$SERVICE_HOST:${S3_SERVICE_PORT:-3333}&quot;</span>
    iniset <span class="nv">$TEMPEST_CONF</span> boto s3_materials_path <span class="s2">&quot;$BOTO_MATERIALS_PATH&quot;</span>
    iniset <span class="nv">$TEMPEST_CONF</span> boto instance_type <span class="s2">&quot;$boto_instance_type&quot;</span>
    iniset <span class="nv">$TEMPEST_CONF</span> boto http_socket_timeout 30
    iniset <span class="nv">$TEMPEST_CONF</span> boto ssh_user <span class="k">${</span><span class="nv">DEFAULT_INSTANCE_USER</span><span class="k">:-</span><span class="nv">cirros</span><span class="k">}</span>

    <span class="nb">echo</span> <span class="s2">&quot;Created tempest configuration file:&quot;</span>
    cat <span class="nv">$TEMPEST_CONF</span>

</pre></div></td></tr><tr><td class=docs>
<p>Restore IFS</p>
</td><td class=code><div class=highlight><pre>
    <span class="nv">IFS</span><span class="o">=</span><span class="nv">$ifs</span>
    <span class="c">#Restore errexit</span>
    <span class="nv">$errexit</span>
<span class="o">}</span>

</pre></div></td></tr><tr><td class=docs>
<p>install_tempest() - Collect source and prepare</p>
</td><td class=code><div class=highlight><pre>
<span class="k">function </span>install_tempest<span class="o">()</span> <span class="o">{</span>
    git_clone <span class="nv">$TEMPEST_REPO</span> <span class="nv">$TEMPEST_DIR</span> <span class="nv">$TEMPEST_BRANCH</span>

</pre></div></td></tr><tr><td class=docs>
<p>Tempest doesn't satisfy its dependencies on its own, so
install them here instead.</p>
</td><td class=code><div class=highlight><pre>
    pip_install -r <span class="nv">$TEMPEST_DIR</span>/tools/pip-requires
<span class="o">}</span>

</pre></div></td></tr><tr><td class=docs>
<p>init_tempest() - Initialize ec2 images</p>
</td><td class=code><div class=highlight><pre>
<span class="k">function </span>init_tempest<span class="o">()</span> <span class="o">{</span>
    <span class="nb">local </span><span class="nv">base_image_name</span><span class="o">=</span>cirros-0.3.0-x86_64
</pre></div></td></tr><tr><td class=docs>
<p>/opt/stack/devstack/files/images/cirros-0.3.0-x86_64-uec</p>
</td><td class=code><div class=highlight><pre>
    <span class="nb">local </span><span class="nv">image_dir</span><span class="o">=</span><span class="s2">&quot;$FILES/images/${base_image_name}-uec&quot;</span>
    <span class="nb">local </span><span class="nv">kernel</span><span class="o">=</span><span class="s2">&quot;$image_dir/${base_image_name}-vmlinuz&quot;</span>
    <span class="nb">local </span><span class="nv">ramdisk</span><span class="o">=</span><span class="s2">&quot;$image_dir/${base_image_name}-initrd&quot;</span>
    <span class="nb">local </span><span class="nv">disk_image</span><span class="o">=</span><span class="s2">&quot;$image_dir/${base_image_name}-blank.img&quot;</span>
</pre></div></td></tr><tr><td class=docs>
<p>if the cirros uec downloaded and the system is uec capable</p>
</td><td class=code><div class=highlight><pre>
    <span class="k">if</span> <span class="o">[</span> -f <span class="s2">&quot;$kernel&quot;</span> -a -f <span class="s2">&quot;$ramdisk&quot;</span> -a -f <span class="s2">&quot;$disk_image&quot;</span> -a  <span class="s2">&quot;$VIRT_DRIVER&quot;</span> !<span class="o">=</span> <span class="s2">&quot;openvz&quot;</span> <span class="se">\</span>
         -a <span class="se">\(</span> <span class="s2">&quot;$LIBVIRT_TYPE&quot;</span> !<span class="o">=</span> <span class="s2">&quot;lxc&quot;</span> -o <span class="s2">&quot;$VIRT_DRIVER&quot;</span> !<span class="o">=</span> <span class="s2">&quot;libvirt&quot;</span> <span class="se">\)</span> <span class="o">]</span>; <span class="k">then</span>
<span class="k">       </span><span class="nb">echo</span> <span class="s2">&quot;Prepare aki/ari/ami Images&quot;</span>
       <span class="o">(</span> <span class="c">#new namespace</span>
</pre></div></td></tr><tr><td class=docs>
<p>tenant:demo ; user: demo</p>
</td><td class=code><div class=highlight><pre>
           <span class="nb">source</span> <span class="nv">$TOP_DIR</span>/accrc/demo/demo
           euca-bundle-image -i <span class="s2">&quot;$kernel&quot;</span> --kernel <span class="nb">true</span> -d <span class="s2">&quot;$BOTO_MATERIALS_PATH&quot;</span>
           euca-bundle-image -i <span class="s2">&quot;$ramdisk&quot;</span> --ramdisk <span class="nb">true</span> -d <span class="s2">&quot;$BOTO_MATERIALS_PATH&quot;</span>
           euca-bundle-image -i <span class="s2">&quot;$disk_image&quot;</span> -d <span class="s2">&quot;$BOTO_MATERIALS_PATH&quot;</span>
       <span class="o">)</span> 2&gt;&amp;1 &lt;/dev/null | cat
    <span class="k">else</span>
<span class="k">        </span><span class="nb">echo</span> <span class="s2">&quot;Boto materials are not prepared&quot;</span>
    <span class="k">fi</span>
<span class="o">}</span>

</pre></div></td></tr><tr><td class=docs>
<p>Restore xtrace</p>
</td><td class=code><div class=highlight><pre>
<span class="nv">$XTRACE</span>


</pre></div></td></tr><tr><td class=docs>
</td><td class=code><div class=highlight><pre>

</pre></div></td></tr><tr><td class=docs>
</div>
</div>
</body>
</html></td><td class='code'></td></tr>
    </tbody>
    </table>
</div>
</body>
</html>
