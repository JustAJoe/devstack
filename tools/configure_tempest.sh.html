<!DOCTYPE html>
<html>
<head>
    <meta http-eqiv='content-type' content='text/html;charset=utf-8'>
    <title>configure_tempest.sh</title>
    <link rel=stylesheet href="http://jashkenas.github.com/docco/resources/docco.css">
</head>
<body>
<div id=container>
    <div id=background></div>
    <table cellspacing=0 cellpadding=0>
    <thead>
      <tr>
        <th class=docs><h1>configure_tempest.sh</h1></th>
        <th class=code></th>
      </tr>
    </thead>
    <tbody>
        <tr><td class='docs'><?xml version="1.0" encoding="utf-8" ?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="generator" content="Docutils 0.7: http://docutils.sourceforge.net/" />
<title></title>
<style type="text/css">

/*
:Author: David Goodger (goodger@python.org)
:Id: $Id: html4css1.css 6253 2010-03-02 00:24:53Z milde $
:Copyright: This stylesheet has been placed in the public domain.

Default cascading style sheet for the HTML output of Docutils.

See http://docutils.sf.net/docs/howto/html-stylesheets.html for how to
customize this style sheet.
*/

/* used to remove borders from tables and images */
.borderless, table.borderless td, table.borderless th {
  border: 0 }

table.borderless td, table.borderless th {
  /* Override padding for "table.docutils td" with "! important".
     The right padding separates the table cells. */
  padding: 0 0.5em 0 0 ! important }

.first {
  /* Override more specific margin styles with "! important". */
  margin-top: 0 ! important }

.last, .with-subtitle {
  margin-bottom: 0 ! important }

.hidden {
  display: none }

a.toc-backref {
  text-decoration: none ;
  color: black }

blockquote.epigraph {
  margin: 2em 5em ; }

dl.docutils dd {
  margin-bottom: 0.5em }

/* Uncomment (and remove this text!) to get bold-faced definition list terms
dl.docutils dt {
  font-weight: bold }
*/

div.abstract {
  margin: 2em 5em }

div.abstract p.topic-title {
  font-weight: bold ;
  text-align: center }

div.admonition, div.attention, div.caution, div.danger, div.error,
div.hint, div.important, div.note, div.tip, div.warning {
  margin: 2em ;
  border: medium outset ;
  padding: 1em }

div.admonition p.admonition-title, div.hint p.admonition-title,
div.important p.admonition-title, div.note p.admonition-title,
div.tip p.admonition-title {
  font-weight: bold ;
  font-family: sans-serif }

div.attention p.admonition-title, div.caution p.admonition-title,
div.danger p.admonition-title, div.error p.admonition-title,
div.warning p.admonition-title {
  color: red ;
  font-weight: bold ;
  font-family: sans-serif }

/* Uncomment (and remove this text!) to get reduced vertical space in
   compound paragraphs.
div.compound .compound-first, div.compound .compound-middle {
  margin-bottom: 0.5em }

div.compound .compound-last, div.compound .compound-middle {
  margin-top: 0.5em }
*/

div.dedication {
  margin: 2em 5em ;
  text-align: center ;
  font-style: italic }

div.dedication p.topic-title {
  font-weight: bold ;
  font-style: normal }

div.figure {
  margin-left: 2em ;
  margin-right: 2em }

div.footer, div.header {
  clear: both;
  font-size: smaller }

div.line-block {
  display: block ;
  margin-top: 1em ;
  margin-bottom: 1em }

div.line-block div.line-block {
  margin-top: 0 ;
  margin-bottom: 0 ;
  margin-left: 1.5em }

div.sidebar {
  margin: 0 0 0.5em 1em ;
  border: medium outset ;
  padding: 1em ;
  background-color: #ffffee ;
  width: 40% ;
  float: right ;
  clear: right }

div.sidebar p.rubric {
  font-family: sans-serif ;
  font-size: medium }

div.system-messages {
  margin: 5em }

div.system-messages h1 {
  color: red }

div.system-message {
  border: medium outset ;
  padding: 1em }

div.system-message p.system-message-title {
  color: red ;
  font-weight: bold }

div.topic {
  margin: 2em }

h1.section-subtitle, h2.section-subtitle, h3.section-subtitle,
h4.section-subtitle, h5.section-subtitle, h6.section-subtitle {
  margin-top: 0.4em }

h1.title {
  text-align: center }

h2.subtitle {
  text-align: center }

hr.docutils {
  width: 75% }

img.align-left, .figure.align-left, object.align-left {
  clear: left ;
  float: left ;
  margin-right: 1em }

img.align-right, .figure.align-right, object.align-right {
  clear: right ;
  float: right ;
  margin-left: 1em }

img.align-center, .figure.align-center, object.align-center {
  display: block;
  margin-left: auto;
  margin-right: auto;
}

.align-left {
  text-align: left }

.align-center {
  clear: both ;
  text-align: center }

.align-right {
  text-align: right }

/* reset inner alignment in figures */
div.align-right {
  text-align: left }

/* div.align-center * { */
/*   text-align: left } */

ol.simple, ul.simple {
  margin-bottom: 1em }

ol.arabic {
  list-style: decimal }

ol.loweralpha {
  list-style: lower-alpha }

ol.upperalpha {
  list-style: upper-alpha }

ol.lowerroman {
  list-style: lower-roman }

ol.upperroman {
  list-style: upper-roman }

p.attribution {
  text-align: right ;
  margin-left: 50% }

p.caption {
  font-style: italic }

p.credits {
  font-style: italic ;
  font-size: smaller }

p.label {
  white-space: nowrap }

p.rubric {
  font-weight: bold ;
  font-size: larger ;
  color: maroon ;
  text-align: center }

p.sidebar-title {
  font-family: sans-serif ;
  font-weight: bold ;
  font-size: larger }

p.sidebar-subtitle {
  font-family: sans-serif ;
  font-weight: bold }

p.topic-title {
  font-weight: bold }

pre.address {
  margin-bottom: 0 ;
  margin-top: 0 ;
  font: inherit }

pre.literal-block, pre.doctest-block {
  margin-left: 2em ;
  margin-right: 2em }

span.classifier {
  font-family: sans-serif ;
  font-style: oblique }

span.classifier-delimiter {
  font-family: sans-serif ;
  font-weight: bold }

span.interpreted {
  font-family: sans-serif }

span.option {
  white-space: nowrap }

span.pre {
  white-space: pre }

span.problematic {
  color: red }

span.section-subtitle {
  /* font-size relative to parent (h1..h6 element) */
  font-size: 80% }

table.citation {
  border-left: solid 1px gray;
  margin-left: 1px }

table.docinfo {
  margin: 2em 4em }

table.docutils {
  margin-top: 0.5em ;
  margin-bottom: 0.5em }

table.footnote {
  border-left: solid 1px black;
  margin-left: 1px }

table.docutils td, table.docutils th,
table.docinfo td, table.docinfo th {
  padding-left: 0.5em ;
  padding-right: 0.5em ;
  vertical-align: top }

table.docutils th.field-name, table.docinfo th.docinfo-name {
  font-weight: bold ;
  text-align: left ;
  white-space: nowrap ;
  padding-left: 0 }

h1 tt.docutils, h2 tt.docutils, h3 tt.docutils,
h4 tt.docutils, h5 tt.docutils, h6 tt.docutils {
  font-size: 100% }

ul.auto-toc {
  list-style-type: none }

</style>
</head>
<body>
<div class="document">


<p><strong>configure_tempest.sh</strong></p>
</td><td class=code><div class=highlight><pre>
<span class="c">#!/usr/bin/env bash</span>

</pre></div></td></tr><tr><td class=docs>
<p>Build a tempest configuration file from devstack</p>
</td><td class=code><div class=highlight><pre>

<span class="nb">echo</span> <span class="s2">&quot;**************************************************&quot;</span>
<span class="nb">echo</span> <span class="s2">&quot;Configuring Tempest&quot;</span>
<span class="nb">echo</span> <span class="s2">&quot;**************************************************&quot;</span>

</pre></div></td></tr><tr><td class=docs>
<p>This script exits on an error so that errors don't compound and you see
only the first error that occured.</p>
</td><td class=code><div class=highlight><pre>
<span class="nb">set</span> -o errexit

</pre></div></td></tr><tr><td class=docs>
<p>Print the commands being run so that we can see the command that triggers
an error.  It is also useful for following allowing as the install occurs.</p>
</td><td class=code><div class=highlight><pre>
<span class="nb">set</span> -o xtrace

<span class="k">function </span>usage <span class="o">{</span>
    <span class="nb">echo</span> <span class="s2">&quot;$0 - Build tempest.conf&quot;</span>
    <span class="nb">echo</span> <span class="s2">&quot;&quot;</span>
    <span class="nb">echo</span> <span class="s2">&quot;Usage: $0&quot;</span>
    <span class="nb">exit </span>1
<span class="o">}</span>

<span class="k">if</span> <span class="o">[</span> <span class="s2">&quot;$1&quot;</span> <span class="o">=</span> <span class="s2">&quot;-h&quot;</span> <span class="o">]</span>; <span class="k">then</span>
<span class="k">    </span>usage
<span class="k">fi</span>

</pre></div></td></tr><tr><td class=docs>
<p>Keep track of the current directory</p>
</td><td class=code><div class=highlight><pre>
<span class="nv">TOOLS_DIR</span><span class="o">=</span><span class="k">$(</span><span class="nb">cd</span> <span class="k">$(</span>dirname <span class="s2">&quot;$0&quot;</span><span class="k">)</span> <span class="o">&amp;&amp;</span> <span class="nb">pwd</span><span class="k">)</span>
<span class="nv">TOP_DIR</span><span class="o">=</span><span class="k">$(</span><span class="nb">cd</span> <span class="nv">$TOOLS_DIR</span>/..; <span class="nb">pwd</span><span class="k">)</span>

</pre></div></td></tr><tr><td class=docs>
<p>Import common functions</p>
</td><td class=code><div class=highlight><pre>
. <span class="nv">$TOP_DIR</span>/functions

</pre></div></td></tr><tr><td class=docs>
<p>Abort if localrc is not set</p>
</td><td class=code><div class=highlight><pre>
<span class="k">if</span> <span class="o">[</span> ! -e <span class="nv">$TOP_DIR</span>/localrc <span class="o">]</span>; <span class="k">then</span>
<span class="k">    </span><span class="nb">echo</span> <span class="s2">&quot;You must have a localrc with necessary basic configuration defined before proceeding.&quot;</span>
    <span class="nb">exit </span>1
<span class="k">fi</span>

</pre></div></td></tr><tr><td class=docs>
<p>Abort if openrc is not set</p>
</td><td class=code><div class=highlight><pre>
<span class="k">if</span> <span class="o">[</span> ! -e <span class="nv">$TOP_DIR</span>/openrc <span class="o">]</span>; <span class="k">then</span>
<span class="k">    </span><span class="nb">echo</span> <span class="s2">&quot;You must have an openrc with ALL necessary passwords and credentials defined before proceeding.&quot;</span>
    <span class="nb">exit </span>1
<span class="k">fi</span>

</pre></div></td></tr><tr><td class=docs>
<p>Source params</p>
</td><td class=code><div class=highlight><pre>
<span class="nb">source</span> <span class="nv">$TOP_DIR</span>/openrc

</pre></div></td></tr><tr><td class=docs>
<p>Where Openstack code lives</p>
</td><td class=code><div class=highlight><pre>
<span class="nv">DEST</span><span class="o">=</span><span class="k">${</span><span class="nv">DEST</span><span class="k">:-</span><span class="p">/opt/stack</span><span class="k">}</span>

<span class="nv">NOVA_SOURCE_DIR</span><span class="o">=</span><span class="nv">$DEST</span>/nova
<span class="nv">TEMPEST_DIR</span><span class="o">=</span><span class="nv">$DEST</span>/tempest
<span class="nv">CONFIG_DIR</span><span class="o">=</span><span class="nv">$TEMPEST_DIR</span>/etc
<span class="nv">TEMPEST_CONF</span><span class="o">=</span><span class="nv">$CONFIG_DIR</span>/tempest.conf

</pre></div></td></tr><tr><td class=docs>
<p>Use the GUEST_IP unless an explicit IP is set by <tt class="docutils literal">HOST_IP</tt></p>
</td><td class=code><div class=highlight><pre>
<span class="nv">HOST_IP</span><span class="o">=</span><span class="k">${</span><span class="nv">HOST_IP</span><span class="k">:-</span><span class="nv">$GUEST_IP</span><span class="k">}</span>
</pre></div></td></tr><tr><td class=docs>
<p>Use the first IP if HOST_IP still is not set</p>
</td><td class=code><div class=highlight><pre>
<span class="k">if</span> <span class="o">[</span> ! -n <span class="s2">&quot;$HOST_IP&quot;</span> <span class="o">]</span>; <span class="k">then</span>
<span class="k">    </span><span class="nv">HOST_IP</span><span class="o">=</span><span class="sb">`</span><span class="nv">LC_ALL</span><span class="o">=</span>C /sbin/ifconfig  | grep -m 1 <span class="s1">&#39;inet addr:&#39;</span>| cut -d: -f2 | awk <span class="s1">&#39;{print $1}&#39;</span><span class="sb">`</span>
<span class="k">fi</span>

</pre></div></td></tr><tr><td class=docs>
<p>Glance should already contain images to be used in tempest
testing. Here we simply look for images stored in Glance
and set the appropriate variables for use in the tempest config
We ignore ramdisk and kernel images, look for the default image
DEFAULT_IMAGE_NAME. If not found, we set the IMAGE_UUID to the
first image returned and set IMAGE_UUID_ALT to the second,
if there is more than one returned...
... Also ensure we only take active images, so we don't get snapshots in process</p>
</td><td class=code><div class=highlight><pre>
<span class="nv">IMAGE_LINES</span><span class="o">=</span><span class="sb">`</span>glance image-list<span class="sb">`</span>
<span class="nv">IFS</span><span class="o">=</span><span class="s2">&quot;$(echo -e &quot;</span><span class="se">\n\r</span><span class="s2">&quot;)&quot;</span>
<span class="nv">IMAGES</span><span class="o">=</span><span class="s2">&quot;&quot;</span>
<span class="k">for </span>line in <span class="nv">$IMAGE_LINES</span>; <span class="k">do</span>
<span class="k">    if</span> <span class="o">[</span> -z <span class="nv">$DEFAULT_IMAGE_NAME</span> <span class="o">]</span>; <span class="k">then</span>
<span class="k">        </span><span class="nv">IMAGES</span><span class="o">=</span><span class="s2">&quot;$IMAGES `echo $line | grep -v &quot;</span>^<span class="se">\(</span>ID<span class="se">\|</span>+--<span class="se">\)</span><span class="s2">&quot; | grep -v &quot;</span><span class="se">\(</span>aki<span class="se">\|</span>ari<span class="se">\)</span><span class="s2">&quot; | grep &#39;active&#39; | cut -d&#39; &#39; -f2`&quot;</span>
    <span class="k">else</span>
<span class="k">        </span><span class="nv">IMAGES</span><span class="o">=</span><span class="s2">&quot;$IMAGES `echo $line | grep -v &quot;</span>^<span class="se">\(</span>ID<span class="se">\|</span>+--<span class="se">\)</span><span class="s2">&quot; | grep -v &quot;</span><span class="se">\(</span>aki<span class="se">\|</span>ari<span class="se">\)</span><span class="s2">&quot; | grep &#39;active&#39; | grep &quot;</span><span class="nv">$DEFAULT_IMAGE_NAME</span><span class="s2">&quot; | cut -d&#39; &#39; -f2`&quot;</span>
    <span class="k">fi</span>
<span class="k">done</span>
</pre></div></td></tr><tr><td class=docs>
<p>Create array of image UUIDs...</p>
</td><td class=code><div class=highlight><pre>
<span class="nv">IFS</span><span class="o">=</span><span class="s2">&quot; &quot;</span>
<span class="nv">IMAGES</span><span class="o">=(</span><span class="nv">$IMAGES</span><span class="o">)</span>
<span class="nv">NUM_IMAGES</span><span class="o">=</span><span class="k">${#</span><span class="nv">IMAGES</span><span class="p">[*]</span><span class="k">}</span>
<span class="nb">echo</span> <span class="s2">&quot;Found $NUM_IMAGES images&quot;</span>
<span class="k">if</span> <span class="o">[[</span> <span class="nv">$NUM_IMAGES</span> -eq 0 <span class="o">]]</span>; <span class="k">then</span>
<span class="k">    </span><span class="nb">echo</span> <span class="s2">&quot;Found no valid images to use!&quot;</span>
    <span class="nb">exit </span>1
<span class="k">fi</span>
<span class="nv">IMAGE_UUID</span><span class="o">=</span><span class="k">${</span><span class="nv">IMAGES</span><span class="p">[0]</span><span class="k">}</span>
<span class="nv">IMAGE_UUID_ALT</span><span class="o">=</span><span class="nv">$IMAGE_UUID</span>
<span class="k">if</span> <span class="o">[[</span> <span class="nv">$NUM_IMAGES</span> -gt 1 <span class="o">]]</span>; <span class="k">then</span>
<span class="k">    </span><span class="nv">IMAGE_UUID_ALT</span><span class="o">=</span><span class="k">${</span><span class="nv">IMAGES</span><span class="p">[1]</span><span class="k">}</span>
<span class="k">fi</span>

</pre></div></td></tr><tr><td class=docs>
<p>Create tempest.conf from tempest.conf.tpl
copy every time, because the image UUIDS are going to change</p>
</td><td class=code><div class=highlight><pre>
cp <span class="nv">$TEMPEST_CONF</span>.tpl <span class="nv">$TEMPEST_CONF</span>

<span class="nv">COMPUTE_ADMIN_USERNAME</span><span class="o">=</span><span class="k">${</span><span class="nv">ADMIN_USERNAME</span><span class="k">:-</span><span class="nv">admin</span><span class="k">}</span>
<span class="nv">COMPUTE_ADMIN_PASSWORD</span><span class="o">=</span><span class="k">${</span><span class="nv">ADMIN_PASSWORD</span><span class="k">:-</span><span class="nv">secrete</span><span class="k">}</span>
<span class="nv">COMPUTE_ADMIN_TENANT_NAME</span><span class="o">=</span><span class="k">${</span><span class="nv">ADMIN_TENANT</span><span class="k">:-</span><span class="nv">admin</span><span class="k">}</span>

<span class="nv">IDENTITY_ADMIN_USERNAME</span><span class="o">=</span><span class="k">${</span><span class="nv">ADMIN_USERNAME</span><span class="k">:-</span><span class="nv">admin</span><span class="k">}</span>
<span class="nv">IDENTITY_ADMIN_PASSWORD</span><span class="o">=</span><span class="k">${</span><span class="nv">ADMIN_PASSWORD</span><span class="k">:-</span><span class="nv">secrete</span><span class="k">}</span>
<span class="nv">IDENTITY_ADMIN_TENANT_NAME</span><span class="o">=</span><span class="k">${</span><span class="nv">ADMIN_TENANT</span><span class="k">:-</span><span class="nv">admin</span><span class="k">}</span>

<span class="nv">IDENTITY_USE_SSL</span><span class="o">=</span><span class="k">${</span><span class="nv">IDENTITY_USE_SSL</span><span class="k">:-</span><span class="nv">False</span><span class="k">}</span>
<span class="nv">IDENTITY_HOST</span><span class="o">=</span><span class="k">${</span><span class="nv">IDENTITY_HOST</span><span class="k">:-</span><span class="nv">127</span><span class="p">.0.0.1</span><span class="k">}</span>
<span class="nv">IDENTITY_PORT</span><span class="o">=</span><span class="k">${</span><span class="nv">IDENTITY_PORT</span><span class="k">:-</span><span class="nv">5000</span><span class="k">}</span>
<span class="nv">IDENTITY_API_VERSION</span><span class="o">=</span><span class="s2">&quot;v2.0&quot;</span> <span class="c"># Note: need v for now...</span>
</pre></div></td></tr><tr><td class=docs>
<p>TODO(jaypipes): This is dumb and needs to be removed
from the Tempest configuration file entirely...</p>
</td><td class=code><div class=highlight><pre>
<span class="nv">IDENTITY_PATH</span><span class="o">=</span><span class="k">${</span><span class="nv">IDENTITY_PATH</span><span class="k">:-</span><span class="nv">tokens</span><span class="k">}</span>
<span class="nv">IDENTITY_STRATEGY</span><span class="o">=</span><span class="k">${</span><span class="nv">IDENTITY_STRATEGY</span><span class="k">:-</span><span class="nv">keystone</span><span class="k">}</span>
<span class="nv">IDENTITY_CATALOG_TYPE</span><span class="o">=</span>identity

</pre></div></td></tr><tr><td class=docs>
<p>We use regular, non-admin users in Tempest for the USERNAME
substitutions and use ADMIN_USERNAME et al for the admin stuff.
OS_USERNAME et all should be defined in openrc.</p>
</td><td class=code><div class=highlight><pre>
<span class="nv">OS_USERNAME</span><span class="o">=</span><span class="k">${</span><span class="nv">OS_USERNAME</span><span class="k">:-</span><span class="nv">demo</span><span class="k">}</span>
<span class="nv">OS_TENANT_NAME</span><span class="o">=</span><span class="k">${</span><span class="nv">OS_TENANT_NAME</span><span class="k">:-</span><span class="nv">demo</span><span class="k">}</span>
<span class="nv">OS_PASSWORD</span><span class="o">=</span><span class="k">${</span><span class="nv">OS_PASSWORD</span><span class="p">:</span><span class="nv">$ADMIN_PASSWORD</span><span class="k">}</span>

</pre></div></td></tr><tr><td class=docs>
<p>See files/keystone_data.sh where alt_demo user
and tenant are set up...</p>
</td><td class=code><div class=highlight><pre>
<span class="nv">ALT_USERNAME</span><span class="o">=</span><span class="k">${</span><span class="nv">ALT_USERNAME</span><span class="k">:-</span><span class="nv">alt_demo</span><span class="k">}</span>
<span class="nv">ALT_TENANT_NAME</span><span class="o">=</span><span class="k">${</span><span class="nv">ALT_TENANT_NAME</span><span class="k">:-</span><span class="nv">alt_demo</span><span class="k">}</span>
<span class="nv">ALT_PASSWORD</span><span class="o">=</span><span class="nv">$OS_PASSWORD</span>

</pre></div></td></tr><tr><td class=docs>
<p>Check Nova for existing flavors and, if set, look for the
DEFAULT_INSTANCE_TYPE and use that. Otherwise, just use the first flavor.</p>
</td><td class=code><div class=highlight><pre>
<span class="nv">FLAVOR_LINES</span><span class="o">=</span><span class="sb">`</span>nova flavor-list<span class="sb">`</span>
<span class="nv">IFS</span><span class="o">=</span><span class="s2">&quot;$(echo -e &quot;</span><span class="se">\n\r</span><span class="s2">&quot;)&quot;</span>
<span class="nv">FLAVORS</span><span class="o">=</span><span class="s2">&quot;&quot;</span>
<span class="k">for </span>line in <span class="nv">$FLAVOR_LINES</span>; <span class="k">do</span>
<span class="k">    if</span> <span class="o">[</span> -z <span class="nv">$DEFAULT_INSTANCE_TYPE</span> <span class="o">]</span>; <span class="k">then</span>
<span class="k">        </span><span class="nv">FLAVORS</span><span class="o">=</span><span class="s2">&quot;$FLAVORS `echo $line | grep -v &quot;</span>^<span class="se">\(</span>|<span class="se">\s</span>*ID<span class="se">\|</span>+--<span class="se">\)</span><span class="s2">&quot; | cut -d&#39; &#39; -f2`&quot;</span>
    <span class="k">else</span>
<span class="k">        </span><span class="nv">FLAVORS</span><span class="o">=</span><span class="s2">&quot;$FLAVORS `echo $line | grep -v &quot;</span>^<span class="se">\(</span>|<span class="se">\s</span>*ID<span class="se">\|</span>+--<span class="se">\)</span><span class="s2">&quot; | grep &quot;</span><span class="nv">$DEFAULT_INSTANCE_TYPE</span><span class="s2">&quot; | cut -d&#39; &#39; -f2`&quot;</span>
    <span class="k">fi</span>
<span class="k">done</span>
<span class="nv">IFS</span><span class="o">=</span><span class="s2">&quot; &quot;</span>
<span class="nv">FLAVORS</span><span class="o">=(</span><span class="nv">$FLAVORS</span><span class="o">)</span>
<span class="nv">NUM_FLAVORS</span><span class="o">=</span><span class="k">${#</span><span class="nv">FLAVORS</span><span class="p">[*]</span><span class="k">}</span>
<span class="nb">echo</span> <span class="s2">&quot;Found $NUM_FLAVORS flavors&quot;</span>
<span class="k">if</span> <span class="o">[[</span> <span class="nv">$NUM_FLAVORS</span> -eq 0 <span class="o">]]</span>; <span class="k">then</span>
<span class="k">    </span><span class="nb">echo</span> <span class="s2">&quot;Found no valid flavors to use!&quot;</span>
    <span class="nb">exit </span>1
<span class="k">fi</span>
<span class="nv">FLAVOR_REF</span><span class="o">=</span><span class="k">${</span><span class="nv">FLAVORS</span><span class="p">[0]</span><span class="k">}</span>
<span class="nv">FLAVOR_REF_ALT</span><span class="o">=</span><span class="nv">$FLAVOR_REF</span>
<span class="k">if</span> <span class="o">[[</span> <span class="nv">$NUM_FLAVORS</span> -gt 1 <span class="o">]]</span>; <span class="k">then</span>
<span class="k">    </span><span class="nv">FLAVOR_REF_ALT</span><span class="o">=</span><span class="k">${</span><span class="nv">FLAVORS</span><span class="p">[1]</span><span class="k">}</span>
<span class="k">fi</span>

</pre></div></td></tr><tr><td class=docs>
<p>Do any of the following need to be configurable?</p>
</td><td class=code><div class=highlight><pre>
<span class="nv">COMPUTE_CATALOG_TYPE</span><span class="o">=</span>compute
<span class="nv">COMPUTE_CREATE_IMAGE_ENABLED</span><span class="o">=</span>True
<span class="nv">COMPUTE_ALLOW_TENANT_ISOLATION</span><span class="o">=</span>True
<span class="nv">COMPUTE_RESIZE_AVAILABLE</span><span class="o">=</span>False
<span class="nv">COMPUTE_CHANGE_PASSWORD_AVAILABLE</span><span class="o">=</span>False  <span class="c"># not supported with QEMU...</span>
<span class="nv">COMPUTE_LOG_LEVEL</span><span class="o">=</span>ERROR
<span class="nv">BUILD_INTERVAL</span><span class="o">=</span>3
<span class="nv">BUILD_TIMEOUT</span><span class="o">=</span>400
<span class="nv">COMPUTE_BUILD_INTERVAL</span><span class="o">=</span>3
<span class="nv">COMPUTE_BUILD_TIMEOUT</span><span class="o">=</span>400
<span class="nv">VOLUME_BUILD_INTERVAL</span><span class="o">=</span>3
<span class="nv">VOLUME_BUILD_TIMEOUT</span><span class="o">=</span>300
<span class="nv">RUN_SSH</span><span class="o">=</span>True
</pre></div></td></tr><tr><td class=docs>
<p>Check for DEFAULT_INSTANCE_USER and try to connect with that account</p>
</td><td class=code><div class=highlight><pre>
<span class="nv">SSH_USER</span><span class="o">=</span><span class="k">${</span><span class="nv">DEFAULT_INSTANCE_USER</span><span class="k">:-</span><span class="nv">$OS_USERNAME</span><span class="k">}</span>
<span class="nv">NETWORK_FOR_SSH</span><span class="o">=</span>private
<span class="nv">IP_VERSION_FOR_SSH</span><span class="o">=</span>4
<span class="nv">SSH_TIMEOUT</span><span class="o">=</span>4
</pre></div></td></tr><tr><td class=docs>
<p>Whitebox testing configuration for Compute...</p>
</td><td class=code><div class=highlight><pre>
<span class="nv">COMPUTE_WHITEBOX_ENABLED</span><span class="o">=</span>True
<span class="nv">COMPUTE_SOURCE_DIR</span><span class="o">=</span><span class="nv">$NOVA_SOURCE_DIR</span>
<span class="nv">COMPUTE_BIN_DIR</span><span class="o">=</span>/usr/bin/nova
<span class="nv">COMPUTE_CONFIG_PATH</span><span class="o">=</span>/etc/nova/nova.conf
</pre></div></td></tr><tr><td class=docs>
<p>TODO(jaypipes): Create the key file here... right now, no whitebox
tests actually use a key.</p>
</td><td class=code><div class=highlight><pre>
<span class="nv">COMPUTE_PATH_TO_PRIVATE_KEY</span><span class="o">=</span><span class="nv">$TEMPEST_DIR</span>/id_rsa
<span class="nv">COMPUTE_DB_URI</span><span class="o">=</span>mysql://root:<span class="nv">$MYSQL_PASSWORD</span>@localhost/nova

</pre></div></td></tr><tr><td class=docs>
<p>Image test configuration options...</p>
</td><td class=code><div class=highlight><pre>
<span class="nv">IMAGE_HOST</span><span class="o">=</span><span class="k">${</span><span class="nv">IMAGE_HOST</span><span class="k">:-</span><span class="nv">127</span><span class="p">.0.0.1</span><span class="k">}</span>
<span class="nv">IMAGE_PORT</span><span class="o">=</span><span class="k">${</span><span class="nv">IMAGE_PORT</span><span class="k">:-</span><span class="nv">9292</span><span class="k">}</span>
<span class="nv">IMAGE_API_VERSION</span><span class="o">=</span>1
<span class="nv">IMAGE_CATALOG_TYPE</span><span class="o">=</span>image

</pre></div></td></tr><tr><td class=docs>
<p>Network API test configuration</p>
</td><td class=code><div class=highlight><pre>
<span class="nv">NETWORK_CATALOG_TYPE</span><span class="o">=</span>network
<span class="nv">NETWORK_API_VERSION</span><span class="o">=</span>2.0

</pre></div></td></tr><tr><td class=docs>
<p>Volume API test configuration</p>
</td><td class=code><div class=highlight><pre>
<span class="nv">VOLUME_CATALOG_TYPE</span><span class="o">=</span>volume

sed -e <span class="s2">&quot;</span>
<span class="s2">    s,%IDENTITY_USE_SSL%,$IDENTITY_USE_SSL,g;</span>
<span class="s2">    s,%IDENTITY_HOST%,$IDENTITY_HOST,g;</span>
<span class="s2">    s,%IDENTITY_PORT%,$IDENTITY_PORT,g;</span>
<span class="s2">    s,%IDENTITY_API_VERSION%,$IDENTITY_API_VERSION,g;</span>
<span class="s2">    s,%IDENTITY_PATH%,$IDENTITY_PATH,g;</span>
<span class="s2">    s,%IDENTITY_STRATEGY%,$IDENTITY_STRATEGY,g;</span>
<span class="s2">    s,%IDENTITY_CATALOG_TYPE%,$IDENTITY_CATALOG_TYPE,g;</span>
<span class="s2">    s,%USERNAME%,$OS_USERNAME,g;</span>
<span class="s2">    s,%PASSWORD%,$OS_PASSWORD,g;</span>
<span class="s2">    s,%TENANT_NAME%,$OS_TENANT_NAME,g;</span>
<span class="s2">    s,%ALT_USERNAME%,$ALT_USERNAME,g;</span>
<span class="s2">    s,%ALT_PASSWORD%,$ALT_PASSWORD,g;</span>
<span class="s2">    s,%ALT_TENANT_NAME%,$ALT_TENANT_NAME,g;</span>
<span class="s2">    s,%COMPUTE_CATALOG_TYPE%,$COMPUTE_CATALOG_TYPE,g;</span>
<span class="s2">    s,%COMPUTE_ALLOW_TENANT_ISOLATION%,$COMPUTE_ALLOW_TENANT_ISOLATION,g;</span>
<span class="s2">    s,%COMPUTE_CREATE_IMAGE_ENABLED%,$COMPUTE_CREATE_IMAGE_ENABLED,g;</span>
<span class="s2">    s,%COMPUTE_RESIZE_AVAILABLE%,$COMPUTE_RESIZE_AVAILABLE,g;</span>
<span class="s2">    s,%COMPUTE_CHANGE_PASSWORD_AVAILABLE%,$COMPUTE_CHANGE_PASSWORD_AVAILABLE,g;</span>
<span class="s2">    s,%COMPUTE_WHITEBOX_ENABLED%,$COMPUTE_WHITEBOX_ENABLED,g;</span>
<span class="s2">    s,%COMPUTE_LOG_LEVEL%,$COMPUTE_LOG_LEVEL,g;</span>
<span class="s2">    s,%BUILD_INTERVAL%,$BUILD_INTERVAL,g;</span>
<span class="s2">    s,%BUILD_TIMEOUT%,$BUILD_TIMEOUT,g;</span>
<span class="s2">    s,%COMPUTE_BUILD_INTERVAL%,$COMPUTE_BUILD_INTERVAL,g;</span>
<span class="s2">    s,%COMPUTE_BUILD_TIMEOUT%,$COMPUTE_BUILD_TIMEOUT,g;</span>
<span class="s2">    s,%RUN_SSH%,$RUN_SSH,g;</span>
<span class="s2">    s,%SSH_USER%,$SSH_USER,g;</span>
<span class="s2">    s,%NETWORK_FOR_SSH%,$NETWORK_FOR_SSH,g;</span>
<span class="s2">    s,%IP_VERSION_FOR_SSH%,$IP_VERSION_FOR_SSH,g;</span>
<span class="s2">    s,%SSH_TIMEOUT%,$SSH_TIMEOUT,g;</span>
<span class="s2">    s,%IMAGE_ID%,$IMAGE_UUID,g;</span>
<span class="s2">    s,%IMAGE_ID_ALT%,$IMAGE_UUID_ALT,g;</span>
<span class="s2">    s,%FLAVOR_REF%,$FLAVOR_REF,g;</span>
<span class="s2">    s,%FLAVOR_REF_ALT%,$FLAVOR_REF_ALT,g;</span>
<span class="s2">    s,%COMPUTE_CONFIG_PATH%,$COMPUTE_CONFIG_PATH,g;</span>
<span class="s2">    s,%COMPUTE_SOURCE_DIR%,$COMPUTE_SOURCE_DIR,g;</span>
<span class="s2">    s,%COMPUTE_BIN_DIR%,$COMPUTE_BIN_DIR,g;</span>
<span class="s2">    s,%COMPUTE_PATH_TO_PRIVATE_KEY%,$COMPUTE_PATH_TO_PRIVATE_KEY,g;</span>
<span class="s2">    s,%COMPUTE_DB_URI%,$COMPUTE_DB_URI,g;</span>
<span class="s2">    s,%IMAGE_HOST%,$IMAGE_HOST,g;</span>
<span class="s2">    s,%IMAGE_PORT%,$IMAGE_PORT,g;</span>
<span class="s2">    s,%IMAGE_API_VERSION%,$IMAGE_API_VERSION,g;</span>
<span class="s2">    s,%IMAGE_CATALOG_TYPE%,$IMAGE_CATALOG_TYPE,g;</span>
<span class="s2">    s,%COMPUTE_ADMIN_USERNAME%,$COMPUTE_ADMIN_USERNAME,g;</span>
<span class="s2">    s,%COMPUTE_ADMIN_PASSWORD%,$COMPUTE_ADMIN_PASSWORD,g;</span>
<span class="s2">    s,%COMPUTE_ADMIN_TENANT_NAME%,$COMPUTE_ADMIN_TENANT_NAME,g;</span>
<span class="s2">    s,%IDENTITY_ADMIN_USERNAME%,$IDENTITY_ADMIN_USERNAME,g;</span>
<span class="s2">    s,%IDENTITY_ADMIN_PASSWORD%,$IDENTITY_ADMIN_PASSWORD,g;</span>
<span class="s2">    s,%IDENTITY_ADMIN_TENANT_NAME%,$IDENTITY_ADMIN_TENANT_NAME,g;</span>
<span class="s2">    s,%NETWORK_CATALOG_TYPE%,$NETWORK_CATALOG_TYPE,g;</span>
<span class="s2">    s,%NETWORK_API_VERSION%,$NETWORK_API_VERSION,g;</span>
<span class="s2">    s,%VOLUME_CATALOG_TYPE%,$VOLUME_CATALOG_TYPE,g;</span>
<span class="s2">    s,%VOLUME_BUILD_INTERVAL%,$VOLUME_BUILD_INTERVAL,g;</span>
<span class="s2">    s,%VOLUME_BUILD_TIMEOUT%,$VOLUME_BUILD_TIMEOUT,g;</span>
<span class="s2">&quot;</span> -i <span class="nv">$TEMPEST_CONF</span>

<span class="nb">echo</span> <span class="s2">&quot;Created tempest configuration file:&quot;</span>
cat <span class="nv">$TEMPEST_CONF</span>

<span class="nb">echo</span> <span class="s2">&quot;\n&quot;</span>
<span class="nb">echo</span> <span class="s2">&quot;**************************************************&quot;</span>
<span class="nb">echo</span> <span class="s2">&quot;Finished Configuring Tempest&quot;</span>
<span class="nb">echo</span> <span class="s2">&quot;**************************************************&quot;</span>


</pre></div></td></tr><tr><td class=docs>
</td><td class=code><div class=highlight><pre>

</pre></div></td></tr><tr><td class=docs>
</div>
</body>
</html></td><td class='code'></td></tr>
    </tbody>
    </table>
</div>
</body>
</html>
